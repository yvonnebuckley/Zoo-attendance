---
title: "Zoo Attendance SEM"
author: "Andew Mooney"
date: "08/08/2019"
output:
  html_document: default
  pdf_document: default
---
```{r global_options, include=FALSE}
knitr::opts_chunk$set(warning = FALSE)
```

This script describes how we developed the structural equation models in the paper Mooney _et al.,_ 2019. 

This is based on the approach described in (Grace _et al.,_ 2015) and similar to the semi-exploratory modelling approach implemented in (Grace _et al.,_ 2016). The module __Quantitative Analysis Using Structural Equation Modeling__ provided by the United States Geological Survey and developed by Dr. James Grace (available at:https://www.usgs.gov/centers/wetland-and-aquatic-research-center/science/quantitative-analysis-using-structural-equation?qt-science_center_objects=0#qt-science_center_objects) was used as an introduction to SEM in ecology and as a guide for the correction implementation of SEM. Fan _et al.,_ 2016 was also used as a guide to help avoid common mistakes in SEM implementation and reporting, with a particular focus on SEM in ecological studies. 

## Data and Packages
We use the lavaan package, lavaan.survey, and AICcmodavg packages to fit the models and determine which variables to include in the final SEM model.
```{r setup}

# load the packages
library(lavaan)
library(lavaan.survey)
library(AICcmodavg)
library(survey)

# We also load the additional function "lavaan.modavg.R" to generate a table 
# of AICc model comparisons.
source("lavaan.modavg.R")

```


We then upload the data. This included the attendance model data (Supplementary Data 1, n = 458 institutions), the in situ model data (Supplementary Data 2, subset of n = 119 institutions) and four random sets of the attendance data (consisting of n = 200 each) which were used to validate the final model. See the supplementary information for definitions of each variable included in Supplementary Data 1 and 2.

```{r data}
# Load Data S1 (attendance model data)
DataS1 <- read.csv("Supplementary Data 1.csv", header = T, sep = ",")

# reading the in situ model data (Data S2)
DataS2 <- read.csv("Supplementary Data 2.csv", header = T, sep = ",")

#read in the four validation data sets
validationset1 <- read.csv("validationset1.csv", header = T, sep = "," )
validationset2 <- read.csv("validationset2.csv", header = T, sep = "," )
validationset3 <- read.csv("validationset3.csv", header = T, sep = "," )
validationset4 <- read.csv("validationset4.csv", header = T, sep = "," )

# We then rename the attendance and in situ model data and retain the raw orginal data. 
sem_attendance_data <- DataS1
sem_in_situ_data <- DataS2

```

## Logging and mean centered data

Standardising the data is an important step for SEM and a requirement of using lavaan, as lavaan requires the standardization of variances to an approximately similar scale. This ensures all variables are on similar scales and hence weighted appropriately when fitting the model. 
Here we log each of the variables.


```{r logging}

# log transformation of the variables
sem_attendance_data$lAttendance <- log(sem_attendance_data$Attendance) 
sem_attendance_data$lZoo.Area.ha <- log(sem_attendance_data$Zoo.Area.ha) 
sem_attendance_data$lSp.Richness <- log(sem_attendance_data$Sp.Richness) 
sem_attendance_data$lTotal.Animals <- log(sem_attendance_data$Total.Animals) 
sem_attendance_data$lThreatened.Sp <- log(sem_attendance_data$Threatened.Sp) 
sem_attendance_data$lProp.Threat.Sp <- log(sem_attendance_data$Prop.Threat.Sp) 
sem_attendance_data$lProp.Threat.Abund <- log(sem_attendance_data$Prop.Threat.Abund) 
sem_attendance_data$lMean.Sp.BodyMass <- log(sem_attendance_data$Mean.Sp.BodyMass) 
sem_attendance_data$lMean.Sp.BodyMassXAbund <- log(sem_attendance_data$Mean.Sp.BodyMassXAbund) 
sem_attendance_data$lBrillouin.Index <- log(sem_attendance_data$Brillouin.Index) 
sem_attendance_data$lMean.Jaccard.Dissim.P.A. <- log(sem_attendance_data$Mean.Jaccard.Dissim.P.A.) 
sem_attendance_data$lGDP.Millions <- log(sem_attendance_data$GDP.Millions) 
sem_attendance_data$lNat_Pop._WB2015 <- log(sem_attendance_data$Nat_Pop._WB2015) 
sem_attendance_data$lX50km_Pop <- log(sem_attendance_data$X50km_Pop) 
sem_attendance_data$lX10km_Pop <- log(sem_attendance_data$X10km_Pop) 
sem_attendance_data$lMean.Raup.Crick <- log(sem_attendance_data$Mean.Raup.Crick)

sem_in_situ_data$linsitu <- log(sem_in_situ_data$insitu)
sem_in_situ_data$lAttendance <- log(sem_in_situ_data$Attendance) 
sem_in_situ_data$lZoo.Area.ha <- log(sem_in_situ_data$Zoo.Area.ha) 
sem_in_situ_data$lSp.Richness <- log(sem_in_situ_data$Sp.Richness) 
sem_in_situ_data$lTotal.Animals <- log(sem_in_situ_data$Total.Animals) 
sem_in_situ_data$lThreatened.Sp <- log(sem_in_situ_data$Threatened.Sp) 
sem_in_situ_data$lProp.Threat.Sp <- log(sem_in_situ_data$Prop.Threat.Sp) 
sem_in_situ_data$lProp.Threat.Abund <- log(sem_in_situ_data$Prop.Threat.Abund) 
sem_in_situ_data$lMean.Sp.BodyMass <- log(sem_in_situ_data$Mean.Sp.BodyMass) 
sem_in_situ_data$lMean.Sp.BodyMassXAbund <- log(sem_in_situ_data$Mean.Sp.BodyMassXAbund) 
sem_in_situ_data$lBrillouin.Index <- log(sem_in_situ_data$Brillouin.Index) 
sem_in_situ_data$lMean.Jaccard.Dissim.P.A. <- log(sem_in_situ_data$Mean.Jaccard.Dissim.P.A.) 
sem_in_situ_data$lGDP.Millions <- log(sem_in_situ_data$GDP.Millions) 
sem_in_situ_data$lNat_Pop._WB2015 <- log(sem_in_situ_data$Nat_Pop._WB2015) 
sem_in_situ_data$lX50km_Pop <- log(sem_in_situ_data$X50km_Pop) 
sem_in_situ_data$lX10km_Pop <- log(sem_in_situ_data$X10km_Pop) 
sem_in_situ_data$lMean.Raup.Crick <- log(sem_in_situ_data$Mean.Raup.Crick) 

```


We then mean center the data and express it in units of standard deviation.
```{r mean centering}

# Mean Centering and Standardizing
sem_attendance_data$Attendance2 <- mean_center(sem_attendance_data$lAttendance)
sem_attendance_data$Zoo.Area.ha2 <- mean_center(sem_attendance_data$lZoo.Area.ha)
sem_attendance_data$Sp.Richness2 <- mean_center(sem_attendance_data$lSp.Richness)
sem_attendance_data$Total.Animals2 <- mean_center(sem_attendance_data$lTotal.Animals)
sem_attendance_data$Mam.Sp.Richness2 <- mean_center(sem_attendance_data$Mam.Sp.Richness)
sem_attendance_data$Prop.Mam.Sp2 <- mean_center(sem_attendance_data$Prop.Mam.Sp)
sem_attendance_data$Prop.Mam.Abdun2 <- mean_center(sem_attendance_data$Prop.Mam.Abdun)
sem_attendance_data$Threatened.Sp2 <- mean_center(sem_attendance_data$lThreatened.Sp)
sem_attendance_data$Prop.Threat.Sp2 <- mean_center(sem_attendance_data$lProp.Threat.Sp)
sem_attendance_data$Prop.Threat.Abund2 <- mean_center(sem_attendance_data$lProp.Threat.Abund)
sem_attendance_data$Mean.Sp.BodyMass2 <- mean_center(sem_attendance_data$lMean.Sp.BodyMass)
sem_attendance_data$Mean.Sp.BodyMassXAbund2 <- mean_center(sem_attendance_data$lMean.Sp.BodyMassXAbund)
sem_attendance_data$Brillouin.Index2 <- mean_center(sem_attendance_data$lBrillouin.Index)
sem_attendance_data$Mean.Jaccard.Dissim.P.A.2 <- mean_center(sem_attendance_data$lMean.Jaccard.Dissim.P.A.)
sem_attendance_data$GDP.Millions2 <- mean_center(sem_attendance_data$lGDP.Millions)
sem_attendance_data$Nat_Pop._WB20152 <- mean_center(sem_attendance_data$lNat_Pop._WB2015)
sem_attendance_data$X50km_Pop2 <- mean_center(sem_attendance_data$lX50km_Pop)
sem_attendance_data$X10km_Pop2 <- mean_center(sem_attendance_data$lX10km_Pop)
sem_attendance_data$Mean.Raup.Crick2 <- mean_center(sem_attendance_data$lMean.Raup.Crick)


sem_in_situ_data$insitu2 <- mean_center(sem_in_situ_data$linsitu)
sem_in_situ_data$Attendance2 <- mean_center(sem_in_situ_data$lAttendance)
sem_in_situ_data$Zoo.Area.ha2 <- mean_center(sem_in_situ_data$lZoo.Area.ha)
sem_in_situ_data$Sp.Richness2 <- mean_center(sem_in_situ_data$lSp.Richness)
sem_in_situ_data$Total.Animals2 <- mean_center(sem_in_situ_data$lTotal.Animals)
sem_in_situ_data$Mam.Sp.Richness2 <- mean_center(sem_in_situ_data$Mam.Sp.Richness)
sem_in_situ_data$Prop.Mam.Sp2 <- mean_center(sem_in_situ_data$Prop.Mam.Sp)
sem_in_situ_data$Prop.Mam.Abdun2 <- mean_center(sem_in_situ_data$Prop.Mam.Abdun)
sem_in_situ_data$Threatened.Sp2 <- mean_center(sem_in_situ_data$lThreatened.Sp)
sem_in_situ_data$Prop.Threat.Sp2 <- mean_center(sem_in_situ_data$lProp.Threat.Sp)
sem_in_situ_data$Prop.Threat.Abund2 <- mean_center(sem_in_situ_data$lProp.Threat.Abund)
sem_in_situ_data$Mean.Sp.BodyMass2 <- mean_center(sem_in_situ_data$lMean.Sp.BodyMass)
sem_in_situ_data$Mean.Sp.BodyMassXAbund2 <- mean_center(sem_in_situ_data$lMean.Sp.BodyMassXAbund)
sem_in_situ_data$Brillouin.Index2 <- mean_center(sem_in_situ_data$lBrillouin.Index)
sem_in_situ_data$Mean.Jaccard.Dissim.P.A.2 <- mean_center(sem_in_situ_data$lMean.Jaccard.Dissim.P.A.)
sem_in_situ_data$GDP.Millions2 <- mean_center(sem_in_situ_data$lGDP.Millions)
sem_in_situ_data$Nat_Pop._WB20152 <- mean_center(sem_in_situ_data$lNat_Pop._WB2015)
sem_in_situ_data$X50km_Pop2 <- mean_center(sem_in_situ_data$lX50km_Pop)
sem_in_situ_data$X10km_Pop2 <- mean_center(sem_in_situ_data$lX10km_Pop)
sem_in_situ_data$Mean.Raup.Crick2<- mean_center(sem_in_situ_data$lMean.Raup.Crick)

```



# Attendance SEM 

Two distinct SEM frameworks were tested, the Attendance model and the In Situ model. The Attendance model tested the relationship between visitor attendance and all the various specified variables for 458 institutions globally. This model did not include any in situ contribution data. The In Situ model tested the relationship between visitor attendance, in situ contributions and all the various specified variables for a subset of 119 institutions in North America for which in situ contribution data was available. The results of the Attendance model were used to guide the development of the Attendance linked pathways in the In Situ model as the larger sample size of the Attendance model had higher power.

Two models were developed, one based on species presence-absence per institution and the the other which also conisdered species' population sizes per institution. This was important for calculating mean species body mass per institution, the proportion of threatened species per institution etc. First we develop the model based on species presence-absence. 

# Species Presence - Absence
## Model 1 (a priori meta-model)

We now define our starting model for the SEM based on the a priori meta-model which is constructed based on evidence from the litrature and combined with proposed causal hypotheses. This model includes all previously identified evidence-based relationships and the numerous proposed causal pathways to visitor attendance. The development of this model can be found in the Supplementary information.

```{r 1.1st Att SEM}
# Attendance SEM (Presence-Absence)

# Model 1
# Based on a priori meta-model and proposed causal pathways

mod.1 <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Sp2 + Prop.Threat.Sp2
+ Mean.Sp.BodyMass2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2 + GDP.Millions2 + Nat_Pop._WB20152

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Zoo.Area.ha2 + Prop.Mam.Sp2
Prop.Threat.Sp2 ~ Brillouin.Index2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2'

```

We then fit the model, generate the model summary and generate a selection of absolute fit indices (e.g. Standardized Root Mean Square Residual) and incremental fit indices (e.g. Comparative Fit Index), to account for the differential sensitivity of fit indices to data distribution, model size and sample size (Hu & Bentler, 1999). We then generate modification indices to identify pathways for inclusion, with a standard cut-off level for the chi-square test criterion of 3.84 (Burnham and Anderson, 2002).

Given the nested nature of the data (institutions within countries), we then adjust the model design to take this into considerdation. This is done using the lavaan.survey package. Once again, the model summary, fit indices and modification indices were all generated. A warning is produced by lavaan about model identifiability, most likely due to over-fitting, co-linearity and too few institutions within countries (in the nested design). We proceed with the model fitting noting this warning and as the model is refined this warning does not occur in the final set of models tested.

```{r 1.2st Att SEM fit}
# Fit model and generate model summary
mod.1.fit <- sem(mod.1, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.1.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.1.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi1 <- modindices(mod.1.fit)
print(mi1[mi1$mi > 3.0,])


# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj1 <- lavaan.survey(lavaan.fit = mod.1.fit, survey.design = design) 
summary(fit.adj1, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj1, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi1adj <- modindices(fit.adj1)
print(mi1adj[mi1adj$mi > 3.0,])


```



## Model 2 

Based on the modification indices generated from the first model, we can see that __Sp.Richness2  ~  Mam.Sp.Richness2__ has the highest mi value of __349.340__. This far exceeds the standard cut-off level for the chi-square test criterion of 3.84 (Burnham and Anderson, 2002). This is also one of the most intuitive relationships, as if we increase mammal species richness, then of course we are going to increase overall species richness simulataneously. As a result, we add this relationship to our model. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 2nd Att SEM}
# Attendance SEM (Presence-Absence)

# Model 2
# Addition of Sp.Richness2 ~ Mam.Sp.Richness2, mi = 349.342

mod.2 <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Sp2 + Prop.Threat.Sp2
+ Mean.Sp.BodyMass2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2 + GDP.Millions2 + Nat_Pop._WB20152

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Zoo.Area.ha2 + Prop.Mam.Sp2 + Mam.Sp.Richness2
Prop.Threat.Sp2 ~ Brillouin.Index2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2'

# Fit model and generate model summary
mod.2.fit <- sem(mod.2, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.2.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.2.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi2 <- modindices(mod.2.fit)
print(mi2[mi2$mi > 3.0,])


# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj2 <- lavaan.survey(lavaan.fit = mod.2.fit, survey.design = design) 
summary(fit.adj2, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj2, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi2adj <- modindices(fit.adj2)
print(mi2adj[mi2adj$mi > 3.0,])


```


## Model 3 

Based on the modification indices generated from the second model, we can see that __Mean.Raup.Crick2 ~ Mean.Sp.BodyMass2__ has the highest mi value of __112.474__. This far exceeds the standard cut-off level for the chi-square test criterion of 3.84 (Burnham and Anderson, 2002). This also makes theoretical sense, as if we increase the mean species body mass of a collection, then logically the institution can hold fewer species overall and therefore has a higher chance of having an overlapping collection composition with other institutions (Raup Crick is a community ecology dissimilarity index based on species presence/absence data). As a result, we add this relationship to our model. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 3rd Att SEM}
# Attendance SEM (Presence-Absence)

# Model 3
# Addition of Mean.Raup.Crick2 ~ Mean.Sp.BodyMass2, mi = 112.474

mod.3 <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Sp2 + Prop.Threat.Sp2
+ Mean.Sp.BodyMass2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2 + GDP.Millions2 + Nat_Pop._WB20152

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Zoo.Area.ha2 + Prop.Mam.Sp2 + Mam.Sp.Richness2
Prop.Threat.Sp2 ~ Brillouin.Index2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMass2'

# Fit model and generate model summary
mod.3.fit <- sem(mod.3, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.3.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.3.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi3 <- modindices(mod.3.fit)
print(mi3[mi3$mi > 3.0,])


# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj3 <- lavaan.survey(lavaan.fit = mod.3.fit, survey.design = design) 
summary(fit.adj3, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj3, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi3adj <- modindices(fit.adj3)
print(mi3adj[mi3adj$mi > 3.0,])


```


## Model 4 

Based on the modification indices generated from the third model, we can see that __Brillouin.Index2 ~ GDP.Millions2__ has the highest mi value of __58.529__. This far exceeds the standard cut-off level for the chi-square test criterion of 3.84 (Burnham and Anderson, 2002). This also makes theoretical sense, as it is logical to assume that countries with a higher GDP can afford to have much more diverse zoological collections. There is likely a historical element also at play here, however this is beyond what is deducible from the data available. As a result, we add this relationship to our model. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 4th Att SEM}
# Attendance SEM (Presence-Absence)

# Model 4
# Addition of Brillouin.Index2 ~ GDP.Millions2, mi = 58.529

mod.4 <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Sp2 + Prop.Threat.Sp2
+ Mean.Sp.BodyMass2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2 + GDP.Millions2 + Nat_Pop._WB20152

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Zoo.Area.ha2 + Prop.Mam.Sp2 + Mam.Sp.Richness2
Prop.Threat.Sp2 ~ Brillouin.Index2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2 + GDP.Millions2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMass2'

# Fit model and generate model summary
mod.4.fit <- sem(mod.4, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.4.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.4.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi4 <- modindices(mod.4.fit)
print(mi4[mi4$mi > 3.0,])


# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj4 <- lavaan.survey(lavaan.fit = mod.4.fit, survey.design = design) 
summary(fit.adj4, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj4, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi4adj <- modindices(fit.adj4)
print(mi4adj[mi4adj$mi > 3.0,])


```


## Model 5 

Based on the modification indices generated from the fourth model, we can see that __Prop.Threat.Sp2 ~ Prop.Mam.Sp2__ has the highest mi value of __46.213__. This far exceeds the standard cut-off level for the chi-square test criterion of 3.84 (Burnham and Anderson, 2002). As contemporary zoological collections are taxonomically biased towards mammals, and particularly biased towards mammalian species which are often less threatened than their close relatives not held in zoos (Martin _et al.,_ 2014), this suggestion should not come as a surprise. As a result, we add this relationship to our model. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 5th Att SEM}
# Attendance SEM (Presence-Absence)

# Model 5
# Addition of Prop.Threat.Sp2 ~ Prop.Mam.Sp2, mi = 46.213

mod.5 <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Sp2 + Prop.Threat.Sp2
+ Mean.Sp.BodyMass2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2 + GDP.Millions2 + Nat_Pop._WB20152

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Zoo.Area.ha2 + Prop.Mam.Sp2 + Mam.Sp.Richness2
Prop.Threat.Sp2 ~ Brillouin.Index2 + Prop.Mam.Sp2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2 + GDP.Millions2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMass2'

# Fit model and generate model summary
mod.5.fit <- sem(mod.5, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.5.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.5.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi5 <- modindices(mod.5.fit)
print(mi5[mi5$mi > 3.0,])


# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj5 <- lavaan.survey(lavaan.fit = mod.5.fit, survey.design = design) 
summary(fit.adj5, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj5, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi5adj <- modindices(fit.adj5)
print(mi5adj[mi5adj$mi > 3.0,])


```


## Model 6 

Based on the modification indices generated from the fifth model, we can see that there are several relationships with similarly high mi values, for example:
__Nat_Pop._WB20152 ~ Sp.Richness2 31.565, mi = 31.565__
__GDP.Millions2 ~ Brillouin.Index2, mi =  30.672__ 
__GDP.Millions2 ~ Sp.Richness2, mi =  30.346__ 
__Prop.Threat.Sp2 ~ X10km_Pop2, mi =  30.631__
However as modification indices do not take into account whether or not relationships make theoretical sense, these were not considered for inclusion. For example, although __GDP.Millions2 ~ Brillouin.Index2__ has an mi value  of __30.672__, it makes no sense to suggest that the GDP of a country is in any way caused by the taxonomic diversity of individual zoological collections. Therefore, the most intuitive relationship with the highest mi value was identified as __Total.Animals2 ~ GDP.Millions2__, with a corresponding mi value of __29.909__. Although not the highest mi value, this is the most intuitive and still exceeds the standard cut-off level for the chi-square test criterion of 3.84 (Burnham and Anderson, 2002). This is considered intuituive as it is logical to assume that countries with a higher GDP can afford to have zoological collections with many more animals. Again, the exact reasoning behind this is likely rooted in an historical context that exceeds the scope of this work. As a result, we add this relationship to our model. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 

Similar rationale and theoretical sense were appied to all interpretations of modification indices, often resulting in the selection of suggested relationships for inclusion, despite the fact that relationships with higher mi values were observed. This is the reason the development of the a priori meta-model is key and why a deep understanding of the study system in question is needed to guide model modification an interpretation.


```{r 6th Att SEM}
# Attendance SEM (Presence-Absence)

# Model 6
# Addition of Total.Animals2 ~ GDP.Millions2, mi = 29.909

mod.6 <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Sp2 + Prop.Threat.Sp2
+ Mean.Sp.BodyMass2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2 + GDP.Millions2 + Nat_Pop._WB20152

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~ Zoo.Area.ha2 + Prop.Mam.Sp2 + Mam.Sp.Richness2
Prop.Threat.Sp2 ~ Brillouin.Index2 + Prop.Mam.Sp2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2 + GDP.Millions2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMass2'

# Fit model and generate model summary
mod.6.fit <- sem(mod.6, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.6.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.6.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi6 <- modindices(mod.6.fit)
print(mi6[mi6$mi > 3.0,])


# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj6 <- lavaan.survey(lavaan.fit = mod.6.fit, survey.design = design) 
summary(fit.adj6, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj6, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi6adj <- modindices(fit.adj6)
print(mi6adj[mi6adj$mi > 3.0,])


```


## Model 7 

Based on the modification indices generated from the sixth model, there was no clear rationale for the inclusion of any particular relationship. We opted to include the relationship __Sp.Richness2 ~ Mean.Sp.BodyMass2__, as there is clear evidence within the literature that zoological institutions have a limited carrying capacity and that large vertebrates, by their very nature, require ever larger enclosure sizes. Therefore it is deducible that institutions with larger vertebrates will be able to hold fewer species. This semi-exploratory modelling approach is similar to that implemented in Grace _et al.,_ 2016. As a result, we add this relationship to our model. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 7th Att SEM}
# Attendance SEM (Presence-Absence)

# Model 7
# Addition of Sp.Richness2 ~ Mean.Sp.BodyMass2

mod.7 <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Sp2 + Prop.Threat.Sp2
+ Mean.Sp.BodyMass2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2 + GDP.Millions2 + Nat_Pop._WB20152

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~ Zoo.Area.ha2 + Prop.Mam.Sp2 + Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Prop.Threat.Sp2 ~ Brillouin.Index2 + Prop.Mam.Sp2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2 + GDP.Millions2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMass2'

# Fit model and generate model summary
mod.7.fit <- sem(mod.7, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.7.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.7.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi7 <- modindices(mod.7.fit)
print(mi7[mi7$mi > 3.0,])


# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj7 <- lavaan.survey(lavaan.fit = mod.7.fit, survey.design = design) 
summary(fit.adj7, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj7, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi7adj <- modindices(fit.adj7)
print(mi7adj[mi7adj$mi > 3.0,])


```


## Model 8 

Based on the modification indices generated from the seventh model, the most intuitive relationship with the highest mi value was identified as __Mean.Raup.Crick2 ~ Prop.Threat.Sp2__, with a corresponding mi value of __14.716__. Although not the highest mi value, this is the most intuitive and still exceeds the standard cut-off level for the chi-square test criterion of 3.84 (Burnham and Anderson, 2002). This is considered intuituive as it is logical to assume that instiutions with a higher proportion of threatened species will be dissimilar to other institutions, as traditionally
species in zoos are often less threatened than their close relatives not held in zoos and are found in large numbers (Frynta _et al., 2013_; Martin _et al.,_ 2014). Therefore threatened species are likely to be less common and found in fewer numbers, making collections housing them more dissimilar to other institutions. As a result, we add this relationship to our model. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 8th Att SEM}
# Attendance SEM (Presence-Absence)

# Model 8
# Addition of Mean.Raup.Crick2 ~ Prop.Threat.Sp2

mod.8 <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Sp2 + Prop.Threat.Sp2
+ Mean.Sp.BodyMass2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2 + GDP.Millions2 + Nat_Pop._WB20152

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~ Zoo.Area.ha2 + Prop.Mam.Sp2 + Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Prop.Threat.Sp2 ~ Brillouin.Index2 + Prop.Mam.Sp2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2 + GDP.Millions2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMass2 + Prop.Threat.Sp2'

# Fit model and generate model summary
mod.8.fit <- sem(mod.8, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.8.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.8.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi8 <- modindices(mod.8.fit)
print(mi8[mi8$mi > 3.0,])


# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj8 <- lavaan.survey(lavaan.fit = mod.8.fit, survey.design = design) 
summary(fit.adj8, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj8, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi8adj <- modindices(fit.adj8)
print(mi8adj[mi8adj$mi > 3.0,])


```

## Model Comparisons

At this stage we compare the eight models generated using AICc values. Overall model selection from the pool of competing models is achieved using AICc values, with a threshold of more than 2 AICc units lower than nearest competing model being considered sufficient for model selection. 

```{r 1st AICc SEM}
# Model Comparisons using AICc

# Comparing models with and without adjustment for nested nature of data
# library(AICcmodavg) 
# source("lavaan.modavg.R")

aictab.lavaan(list(mod.1.fit, mod.2.fit, mod.3.fit, mod.4.fit, mod.5.fit, mod.6.fit, mod.7.fit, 
                   mod.8.fit, fit.adj1, fit.adj2, fit.adj3, fit.adj4, fit.adj5, fit.adj6, fit.adj7, fit.adj8), 
              c("mod.1", "mod.2", "mod.3", "mod.4", "mod.5", "mod.6", "mod.7", "mod.8",
                "mod.1.nested", "mod.2.nested", "mod.3.nested", "mod.4.nested", "mod.5.nested", "mod.6.nested", "mod.7.nested", "mod.8.nested"))



```

Baed on these results we can see that model 8 is the superior model (lowest AICc values), for both models with and without adjustment for nested nature of data. 

At this stage no other addition is conceptually appealling. Now we use p-values to identify potentially unsupported pathways, with a threshold of 0.05. Highest p-values are considered first for removal.


## Model 9 

Based on the results generated from the nested eight model, the highest p-value relationships to be considered for removal are __Attendance2 ~ Prop.Thret.Sp2__ with a p-value of __0.765__ and __Prop.Threat.Sp2 ~ Brilloun.Indx2__ with a p-value of __0.753__. Therefore we decide to remove these pathways (and subsequently Prop.Thret.Sp2 from the model). Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 9th Att SEM}
# Attendance SEM (Presence-Absence)

# Model 9
# Removal of Attendance2 ~ Prop.Thret.Sp2, p = 0.765
# And subsequently Prop.Thret.Sp2 pathways

mod.9 <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Sp2
+ Mean.Sp.BodyMass2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2 + GDP.Millions2 + Nat_Pop._WB20152

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~ Zoo.Area.ha2 + Prop.Mam.Sp2 + Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2 + GDP.Millions2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMass2'

# Fit model and generate model summary
mod.9.fit <- sem(mod.9, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.9.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.9.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi9 <- modindices(mod.9.fit)
print(mi9[mi9$mi > 3.0,])


# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj9 <- lavaan.survey(lavaan.fit = mod.9.fit, survey.design = design) 
summary(fit.adj9, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj9, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi9adj <- modindices(fit.adj9)
print(mi9adj[mi9adj$mi > 3.0,])


```


## Model 10 

Based on the results generated from the nested ninth model, the highest p-value relationship to be considered for removal is __Sp.Richness2 ~ Men.Sp.BdyMss2__ with a p-value of __0.564__. Therefore we decide to remove this pathway. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 10th Att SEM}
# Attendance SEM (Presence-Absence)

# Model 10
# Removal of Sp.Richness2 ~ Men.Sp.BdyMss2, p = 0.564

mod.10 <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Sp2
+ Mean.Sp.BodyMass2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2 + GDP.Millions2 + Nat_Pop._WB20152

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~ Zoo.Area.ha2 + Prop.Mam.Sp2 + Mam.Sp.Richness2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2 + GDP.Millions2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMass2'

# Fit model and generate model summary
mod.10.fit <- sem(mod.10, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.10.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.10.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi10 <- modindices(mod.10.fit)
print(mi10[mi10$mi > 3.0,])


# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj10 <- lavaan.survey(lavaan.fit = mod.10.fit, survey.design = design) 
summary(fit.adj10, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj10, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi10adj <- modindices(fit.adj10)
print(mi10adj[mi10adj$mi > 3.0,])

# Test whether removal of pathway was justified
anova(fit.adj9, fit.adj10) 
# no significant difference, so link was not needed. 

```

## Model 11 

Based on the results generated from the nested tenth model, the highest p-value relationship to be considered for removal is __Attendance2 ~ Brilloun.Indx2__ with a p-value of __0.235__. Therefore we decide to remove this pathway. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 



```{r 11th Att SEM}
# Attendance SEM (Presence-Absence)

# Model 11
# Removal of Attendance2 ~ Brilloun.Indx2, p = 0.235

mod.11 <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Sp2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2 + GDP.Millions2 + Nat_Pop._WB20152

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~ Zoo.Area.ha2 + Prop.Mam.Sp2 + Mam.Sp.Richness2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2 + GDP.Millions2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMass2'

# Fit model and generate model summary
mod.11.fit <- sem(mod.11, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.11.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.11.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi11 <- modindices(mod.11.fit)
print(mi11[mi11$mi > 3.0,])


# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj11 <- lavaan.survey(lavaan.fit = mod.11.fit, survey.design = design) 
summary(fit.adj11, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj11, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi11adj <- modindices(fit.adj11)
print(mi11adj[mi11adj$mi > 3.0,])

# Test whether removal of pathway was justified
anova(fit.adj10, fit.adj11) 
# no significant difference, so link was not needed. 

```

## Model 12 

Based on the results generated from the nested eleventh model, the highest p-value relationship to be considered for removal is __Attendance2 ~ Prop.Mam.Sp2__ with a p-value of __0.155__. Therefore we decide to remove this pathway. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 



```{r 12th Att SEM}
# Attendance SEM (Presence-Absence)

# Model 12
# Removal of Attendance2 ~ Prop.Mam.Sp2, p = 0.155

mod.12 <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Mean.Sp.BodyMass2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2 + GDP.Millions2 + Nat_Pop._WB20152

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~ Zoo.Area.ha2 + Prop.Mam.Sp2 + Mam.Sp.Richness2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2 + GDP.Millions2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMass2'

# Fit model and generate model summary
mod.12.fit <- sem(mod.12, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.12.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.12.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi12 <- modindices(mod.12.fit)
print(mi12[mi12$mi > 3.0,])


# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj12 <- lavaan.survey(lavaan.fit = mod.12.fit, survey.design = design) 
summary(fit.adj12, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj12, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi12adj <- modindices(fit.adj12)
print(mi12adj[mi12adj$mi > 3.0,])

# Test whether removal of pathway was justified
anova(fit.adj11, fit.adj12) 
# no significant difference, so link was not needed. 

```


## Model 13 

Based on the results generated from the nested twelfth model, the highest p-value relationship to be considered for removal is __Attendance2 ~ Sp.Richness2__ with a p-value of __0.169__. Therefore we decide to remove this pathway. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 



```{r 13th Att SEM}
# Attendance SEM (Presence-Absence)

# Model 13
# Removal of Attendance2 ~ Sp.Richness2, p = 0.169

mod.13 <- 'Attendance2 ~ Zoo.Area.ha2 + Total.Animals2
+ Mam.Sp.Richness2 + Mean.Sp.BodyMass2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2 + GDP.Millions2 + Nat_Pop._WB20152

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~ Zoo.Area.ha2 + Prop.Mam.Sp2 + Mam.Sp.Richness2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2 + GDP.Millions2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMass2'

# Fit model and generate model summary
mod.13.fit <- sem(mod.13, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.13.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.13.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi13 <- modindices(mod.13.fit)
print(mi13[mi13$mi > 3.0,])


# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj13 <- lavaan.survey(lavaan.fit = mod.13.fit, survey.design = design) 
summary(fit.adj13, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj13, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi13adj <- modindices(fit.adj13)
print(mi13adj[mi13adj$mi > 3.0,])

# Test whether removal of pathway was justified
anova(fit.adj12, fit.adj13) 
# no significant difference, so link was not needed. 

```


## Model 14

Based on the results generated from the nested thirteenth model, the highest p-value relationship to be considered for removal is __Sp.Richness2 ~ Zoo.Area.ha2__ with a p-value of __0.129__. Therefore we decide to remove this pathway. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 14th Att SEM}
# Attendance SEM (Presence-Absence)

# Model 14
# Removal of Sp.Richness2 ~ Zoo.Area.ha2, p = 0.129

mod.14 <- 'Attendance2 ~ Zoo.Area.ha2 + Total.Animals2
+ Mam.Sp.Richness2 + Mean.Sp.BodyMass2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2 + GDP.Millions2 + Nat_Pop._WB20152

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~ Prop.Mam.Sp2 + Mam.Sp.Richness2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2 + GDP.Millions2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMass2'

# Fit model and generate model summary
mod.14.fit <- sem(mod.14, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.14.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.14.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi14 <- modindices(mod.14.fit)
print(mi14[mi14$mi > 3.0,])


# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj14 <- lavaan.survey(lavaan.fit = mod.14.fit, survey.design = design) 
summary(fit.adj14, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj14, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi14adj <- modindices(fit.adj14)
print(mi14adj[mi14adj$mi > 3.0,])


```



## Model 15

Based on the results generated from the nested fourteenth model, the highest p-value relationship to be considered for removal is __Mean.Raup.Crick2 ~ Sp.Richness2__ with a p-value of __0.115__. Therefore we decide to remove this pathway. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 15th Att SEM}
# Attendance SEM (Presence-Absence)

# Model 15
# Removal of Mean.Raup.Crick2 ~ Sp.Richness2 , p = 0.115

mod.15 <- 'Attendance2 ~ Zoo.Area.ha2 + Total.Animals2
+ Mam.Sp.Richness2 + Mean.Sp.BodyMass2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2 + GDP.Millions2 + Nat_Pop._WB20152

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~ Prop.Mam.Sp2 + Mam.Sp.Richness2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2 + GDP.Millions2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2'

# Fit model and generate model summary
mod.15.fit <- sem(mod.15, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.15.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.15.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi15 <- modindices(mod.15.fit)
print(mi15[mi15$mi > 3.0,])


# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj15 <- lavaan.survey(lavaan.fit = mod.15.fit, survey.design = design) 
summary(fit.adj15, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj15, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi15adj <- modindices(fit.adj15)
print(mi15adj[mi15adj$mi > 3.0,])


```


## Model 16

Based on the results generated from the nested fifteenth model, the highest p-value relationship to be considered for removal is __Attendance2 ~ Nt_Pp._WB20152__ with a p-value of __0.182__. Therefore we decide to remove this pathway. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 16th Att SEM}
# Attendance SEM (Presence-Absence)

# Model 16
# Removal of Attendance2 ~ Nt_Pp._WB20152, p = 0.182

mod.16 <- 'Attendance2 ~ Zoo.Area.ha2 + Total.Animals2
+ Mam.Sp.Richness2 + Mean.Sp.BodyMass2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~ Prop.Mam.Sp2 + Mam.Sp.Richness2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2 + GDP.Millions2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2'

# Fit model and generate model summary
mod.16.fit <- sem(mod.16, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.16.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.16.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi16 <- modindices(mod.16.fit)
print(mi16[mi16$mi > 3.0,])


# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj16 <- lavaan.survey(lavaan.fit = mod.16.fit, survey.design = design) 
summary(fit.adj16, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj16, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi16adj <- modindices(fit.adj16)
print(mi16adj[mi16adj$mi > 3.0,])


```


## Model 17

Based on the results generated from the nested sixteenth model, the highest p-value relationship to be considered for removal is __Total.Animals2 ~ GDP.Millions2__ with a p-value of __0.074__. Therefore we decide to remove this pathway. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 



```{r 17th Att SEM}
# Attendance SEM (Presence-Absence)

# Model 17
# Removal of Total.Animals2 ~ GDP.Millions2, p = 0.074

mod.17 <- 'Attendance2 ~ Zoo.Area.ha2 + Total.Animals2
+ Mam.Sp.Richness2 + Mean.Sp.BodyMass2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Prop.Mam.Sp2 + Mam.Sp.Richness2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2 + GDP.Millions2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2'

# Fit model and generate model summary
mod.17.fit <- sem(mod.17, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.17.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.17.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi17 <- modindices(mod.17.fit)
print(mi17[mi17$mi > 3.0,])


# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj17 <- lavaan.survey(lavaan.fit = mod.17.fit, survey.design = design) 
summary(fit.adj17, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj17, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi17adj <- modindices(fit.adj17)
print(mi17adj[mi17adj$mi > 3.0,])


```

## Model 18

Based on the results generated from the nested seventeenth model, we see that __Attendance2 ~ X50km_Pop2__ has a p-value of __0.031__, considering a lot of this data is captured in __Attendance2 ~ X10km_Pop2__, we we decide to remove this pathway. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 



```{r 18th Att SEM}
# Attendance SEM (Presence-Absence)

# Model 18
# Removal of Attendance2 ~ X50km_Pop2, p = 0.031

mod.18 <- 'Attendance2 ~ Zoo.Area.ha2 + Total.Animals2
+ Mam.Sp.Richness2 + Mean.Sp.BodyMass2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Prop.Mam.Sp2 + Mam.Sp.Richness2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2 + GDP.Millions2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2'

# Fit model and generate model summary
mod.18.fit <- sem(mod.18, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.18.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.18.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi18 <- modindices(mod.18.fit)
print(mi18[mi18$mi > 3.0,])


# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj18 <- lavaan.survey(lavaan.fit = mod.18.fit, survey.design = design) 
summary(fit.adj18, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj18, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi18adj <- modindices(fit.adj18)
print(mi18adj[mi18adj$mi > 3.0,])


```


## Model 19

Based on the results generated from the nested eighteenth model, the highest p-value relationship to be considered for removal is __Attendance2 ~ Mam.Sp.Rchnss2__ with a p-value of __0.052__. Therefore we decide to remove this pathway. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 19th Att SEM}
# Attendance SEM (Presence-Absence)

# Model 19
# Removal of Attendance2 ~ Mam.Sp.Rchnss2, p = 0.052

mod.19 <- 'Attendance2 ~ Zoo.Area.ha2 + Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Prop.Mam.Sp2 + Mam.Sp.Richness2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2 + GDP.Millions2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2'

# Fit model and generate model summary
mod.19.fit <- sem(mod.19, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.19.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.19.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi19 <- modindices(mod.19.fit)
print(mi19[mi19$mi > 3.0,])


# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj19 <- lavaan.survey(lavaan.fit = mod.19.fit, survey.design = design) 
summary(fit.adj19, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj19, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi19adj <- modindices(fit.adj19)
print(mi19adj[mi19adj$mi > 3.0,])


```


## Model 20

Based on the fact that Brillouin Index is no longer contributing to visitor attendance, it was decided to remove the from the analysis completely in a semi-exploratory manner. Therefore we decide to remove the three pathways associated with this parameter. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 20th Att SEM}
# Attendance SEM (Presence-Absence)

# Model 20
# Removal of Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2 + GDP.Millions2

mod.20 <- 'Attendance2 ~ Zoo.Area.ha2 + Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Prop.Mam.Sp2 + Mam.Sp.Richness2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2'

# Fit model and generate model summary
mod.20.fit <- sem(mod.20, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.20.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.20.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi20 <- modindices(mod.20.fit)
print(mi20[mi20$mi > 3.0,])


# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj20 <- lavaan.survey(lavaan.fit = mod.20.fit, survey.design = design) 
summary(fit.adj20, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj20, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi20adj <- modindices(fit.adj20)
print(mi20adj[mi20adj$mi > 3.0,])


```


## Model Comparisons

At this stage we again compare the models generated using AICc values. Overall model selection from the pool of competing models is achieved using AICc values, with a threshold of more than 2 AICc units lower than nearest competing model being considered sufficient for model selection. Based on these results it is clear that model 20 is superior and the removal of the Brillouin Index was justified.

```{r 2nd AICc SEM}
# Model Comparisons using AICc

# Comparing models with and without adjustment for nested nature of data
# library(AICcmodavg) 
# source("lavaan.modavg.R")

aictab.lavaan(list(mod.1.fit, mod.2.fit, mod.3.fit, mod.4.fit, mod.5.fit, mod.6.fit, mod.7.fit, mod.8.fit, mod.9.fit, mod.10.fit, mod.11.fit, mod.12.fit, mod.13.fit, mod.14.fit, mod.15.fit, mod.16.fit, mod.17.fit, mod.18.fit, mod.19.fit, mod.20.fit, fit.adj1, fit.adj2, fit.adj3, fit.adj4, fit.adj5, fit.adj6, fit.adj7, fit.adj8, fit.adj9, fit.adj10, fit.adj11, fit.adj12, fit.adj13, fit.adj14, fit.adj15, fit.adj16, fit.adj17, fit.adj18,  fit.adj19, fit.adj20), 
              c("mod.1", "mod.2", "mod.3", "mod.4", "mod.5", "mod.6", "mod.7", "mod.8", "mod.9", "mod.10", "mod.11", "mod.12", "mod.13", "mod.14", "mod.15", "mod.16", "mod.17", "mod.18", "mod19", "mod20", "mod.1.nested", "mod.2.nested", "mod.3.nested", "mod.4.nested", "mod.5.nested", "mod.6.nested", "mod.7.nested", "mod.8.nested", "mod.9.nested", "mod.10.nested", "mod.11.nested", "mod.12.nested", "mod.13.nested", "mod.14.nested", "mod.15.nested", "mod.16.nested", "mod.17.nested", "mod.18.nested", "mod.19.nested", "mod.20.nested"))
# Model 20 superior 

```

At this point we turn to the modification indices once again and see if any new suggested links have been generated. 


## Model 21

Based on the modification indices generated from the nested twentieth  model, we can see that __Total.Animals2 ~ GDP.Millions2__ has an mi value of __29.903__ which exceeds the standard cut-off level for the chi-square test criterion of 3.84 (Burnham and Anderson, 2002). Although only the second highest mi value, this is by far the most intuitive of the two, as it is logical to assume that countries with higher GDP values can afford to have more individual animals within a collection or conversely that high GDP will lead to lower number of animals due to increased enclosure sizes and welfare standards in more developed nations. As a result, we add this relationship to our model. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 21st Att SEM}
# Attendance SEM (Presence-Absence)

# Model 21
# Addition of Total.Animals2 ~ GDP.Millions2, mi = 29.903

mod.21 <- 'Attendance2 ~ Zoo.Area.ha2 + Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~ Prop.Mam.Sp2 + Mam.Sp.Richness2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2'

# Fit model and generate model summary
mod.21.fit <- sem(mod.21, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.21.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.21.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi21 <- modindices(mod.21.fit)
print(mi21[mi21$mi > 3.0,])


# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj21 <- lavaan.survey(lavaan.fit = mod.21.fit, survey.design = design) 
summary(fit.adj21, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj21, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi21adj <- modindices(fit.adj21)
print(mi21adj[mi21adj$mi > 3.0,])


```


## Model 22

Based on the modification indices generated from the nested twenty first  model, we can see that __Mean.Raup.Crick2 ~ Sp.Richness2__ has an mi value of __21.846__ which exceeds the standard cut-off level for the chi-square test criterion of 3.84 (Burnham and Anderson, 2002). Although only the second highest mi value, this is by far the most intuitive of the two, as it is logical to assume that insistutions with higher species richness have a greater probability of being dissimilar to other institutional collections. As a result, we add this relationship to our model. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 22nd Att SEM}
# Attendance SEM (Presence-Absence)

# Model 22
# Addition of Mean.Raup.Crick2 ~ Sp.Richness2 21.846, mi = 21.846

mod.22 <- 'Attendance2 ~ Zoo.Area.ha2 + Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~ Prop.Mam.Sp2 + Mam.Sp.Richness2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2 + Sp.Richness2'

# Fit model and generate model summary
mod.22.fit <- sem(mod.22, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.22.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.22.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi22 <- modindices(mod.22.fit)
print(mi22[mi22$mi > 3.0,])


# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj22 <- lavaan.survey(lavaan.fit = mod.22.fit, survey.design = design) 
summary(fit.adj22, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj22, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi22adj <- modindices(fit.adj22)
print(mi22adj[mi22adj$mi > 3.0,])


```


## Model 23

Based on the modification indices generated from the nested twenty second  model, we can see that __Mean.Raup.Crick2 ~ Zoo.Area.ha2__ has an mi value of __8.934__ which exceeds the standard cut-off level for the chi-square test criterion of 3.84 (Burnham and Anderson, 2002). Although not the highest mi value, this is by far the most conceptually appealling, as it is logical to assume that insistutions with more space have the potential to house more animals and therefore have a greater probability of being dissimilar to other institutional collections. As a result, we add this relationship to our model. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 23rd Att SEM}
# Attendance SEM (Presence-Absence)

# Model 23
# Addition of Mean.Raup.Crick2 ~ Zoo.Area.ha2, mi = 8.934

mod.23 <- 'Attendance2 ~ Zoo.Area.ha2 + Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~ Prop.Mam.Sp2 + Mam.Sp.Richness2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2 + Sp.Richness2 + Zoo.Area.ha2'

# Fit model and generate model summary
mod.23.fit <- sem(mod.23, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.23.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.23.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi23 <- modindices(mod.23.fit)
print(mi23[mi23$mi > 3.0,])


# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj23 <- lavaan.survey(lavaan.fit = mod.23.fit, survey.design = design) 
summary(fit.adj23, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj23, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi23adj <- modindices(fit.adj23)
print(mi23adj[mi23adj$mi > 3.0,])


```


## Model 24

At this point we decided to remove __Sp.Richness2 ~ Prop.Mam.Sp2__ from the analysis in a semi-exploratory fashion, as although it is statistically significant, the relationship fails to add much more information than that provided by the existing __Sp.Richness2 ~ Mam.Sp.Richness2__ relationship. As a result, we remove this relationship from our model. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 24th Att SEM}
# Attendance SEM (Presence-Absence)

# Model 24
# Removal of Sp.Richness2 ~ Prop.Mam.Sp2

mod.24 <- 'Attendance2 ~ Zoo.Area.ha2 + Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~Mam.Sp.Richness2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2 + Sp.Richness2 + Zoo.Area.ha2'

# Fit model and generate model summary
mod.24.fit <- sem(mod.24, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.24.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.24.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi24 <- modindices(mod.24.fit)
print(mi24[mi24$mi > 3.0,])


# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj24 <- lavaan.survey(lavaan.fit = mod.24.fit, survey.design = design) 
summary(fit.adj24, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj24, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi24adj <- modindices(fit.adj24)
print(mi24adj[mi24adj$mi > 3.0,])


```


## Model 25

Based on the modification indices generated from the nested twenty fourth  model, we can see that a new relationship has been suggested __Sp.Richness2 ~ Mean.Sp.BodyMass2__, which has the highest mi value of __111.948__,exceeding the standard cut-off level for the chi-square test criterion of 3.84 (Burnham and Anderson, 2002). This relationship is to be expected, as if institutions have larger animals, then owing to their limited carrying capacity and space availability, then they will be able to house fewer species. As a result, we add this relationship to our model. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 25th Att SEM}
# Attendance SEM (Presence-Absence)

# Model 25
# Addition of Sp.Richness2 ~ Mean.Sp.BodyMass2, mi = 11.948

mod.25 <- 'Attendance2 ~ Zoo.Area.ha2 + Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2 + Sp.Richness2 + Zoo.Area.ha2'

# Fit model and generate model summary
mod.25.fit <- sem(mod.25, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.25.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.25.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi25 <- modindices(mod.25.fit)
print(mi25[mi25$mi > 3.0,])


# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj25 <- lavaan.survey(lavaan.fit = mod.25.fit, survey.design = design) 
summary(fit.adj25, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj25, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi25adj <- modindices(fit.adj25)
print(mi25adj[mi25adj$mi > 3.0,])

```


## Model Comparisons

At this stage no more addition seems conceptually appealling, so we again compare the models generated using AICc values. Overall model selection from the pool of competing models is achieved using AICc values, with a threshold of more than 2 AICc units lower than nearest competing model being considered sufficient for model selection. Based on these results it is clear that model 25 is superior. 

```{r 3rd AICc SEM}
# Model Comparisons using AICc

# Comparing models with and without adjustment for nested nature of data
# library(AICcmodavg) 
# source("lavaan.modavg.R")

aictab.lavaan(list(mod.1.fit, mod.2.fit, mod.3.fit, mod.4.fit, mod.5.fit, mod.6.fit, mod.7.fit, mod.8.fit, mod.9.fit, mod.10.fit, mod.11.fit, mod.12.fit, mod.13.fit, mod.14.fit, mod.15.fit, mod.16.fit, mod.17.fit, mod.18.fit, mod.19.fit, mod.20.fit, mod.21.fit, mod.22.fit, mod.23.fit, mod.24.fit, mod.25.fit, fit.adj1, fit.adj2, fit.adj3, fit.adj4, fit.adj5, fit.adj6, fit.adj7, fit.adj8, fit.adj9, fit.adj10, fit.adj11, fit.adj12, fit.adj13, fit.adj14, fit.adj15, fit.adj16, fit.adj17, fit.adj18,  fit.adj19, fit.adj20, fit.adj21, fit.adj22,  fit.adj23, fit.adj24, fit.adj25), 
              c("mod.1", "mod.2", "mod.3", "mod.4", "mod.5", "mod.6", "mod.7", "mod.8", "mod.9", "mod.10", "mod.11", "mod.12", "mod.13", "mod.14", "mod.15", "mod.16", "mod.17", "mod.18", "mod19", "mod20", "mod21", "mod22", "mod23", "mod24", "mod25", "mod.1.nested", "mod.2.nested", "mod.3.nested", "mod.4.nested", "mod.5.nested", "mod.6.nested", "mod.7.nested", "mod.8.nested", "mod.9.nested", "mod.10.nested", "mod.11.nested", "mod.12.nested", "mod.13.nested", "mod.14.nested", "mod.15.nested", "mod.16.nested", "mod.17.nested", "mod.18.nested", "mod.19.nested", "mod.20.nested", "mod.21.nested", "mod.22.nested", "mod.23.nested", "mod.24.nested", "mod.25.nested"))
 

```

Now we look to the three remaining non-significant relationships found in Model 25 and investigate whether each one is justified in its retention.


## Model 26

Removal of non-significant relationship __Attendance2 ~ Zoo.Area.ha2__ and testing whether this is justified. 


```{r 26th Att SEM}
# Attendance SEM (Presence-Absence)

# Model 26
# Removal of Attendance2 ~ Zoo.Area.ha2 from model 25, p = 

mod.26 <- 'Attendance2 ~ Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2 + Sp.Richness2 + Zoo.Area.ha2'

# Fit model and generate model summary
mod.26.fit <- sem(mod.26, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.26.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.26.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi26 <- modindices(mod.26.fit)
print(mi26[mi26$mi > 3.0,])


# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj26 <- lavaan.survey(lavaan.fit = mod.26.fit, survey.design = design) 
summary(fit.adj26, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj26, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi26adj <- modindices(fit.adj26)
print(mi26adj[mi26adj$mi > 3.0,])

# Test whether removal of pathway was justified
anova(fit.adj25, fit.adj26) 

```

Although the p-value is non-significant, the results from the anova suggest that the link __Attendance2 ~ Zoo.Area.ha2__ should be retained.


## Model 27

Removal of non-significant relationship __Total.Animals2 ~ GDP.Millions2__ and testing whether this is justified. 


```{r 27th Att SEM}
# Attendance SEM (Presence-Absence)

# Model 27
# Removal of Total.Animals2 ~ GDP.Millions2 from model 25, p = 0.072

mod.27 <- 'Attendance2 ~ Zoo.Area.ha2 + Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2 + Sp.Richness2 + Zoo.Area.ha2'

# Fit model and generate model summary
mod.27.fit <- sem(mod.27, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.27.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.27.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi27 <- modindices(mod.27.fit)
print(mi27[mi27$mi > 3.0,])


# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj27 <- lavaan.survey(lavaan.fit = mod.27.fit, survey.design = design) 
summary(fit.adj27, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj27, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi27adj <- modindices(fit.adj27)
print(mi27adj[mi27adj$mi > 3.0,])

# Test whether removal of pathway was justified
anova(fit.adj25, fit.adj27) 
```

Although the p-value anova appear non-significant, looking at the various absolute and incremental fit indices suggests that the link __Total.Animals2 ~ GDP.Millions2__ should be retained, as it improves model-data fit.


## Model 28

Removal of non-significant relationship __Mean.Raup.Crick2 ~ Sp.Richness2__ and testing whether this is justified. 

```{r 28th Att SEM}
# Attendance SEM (Presence-Absence)

# Model 28
# Removal of Mean.Raup.Crick2 ~ Sp.Richness2 from model 25, p = 0.143

mod.28 <- 'Attendance2 ~ Zoo.Area.ha2 + Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2 + Zoo.Area.ha2'

# Fit model and generate model summary
mod.28.fit <- sem(mod.28, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.28.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.28.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi28 <- modindices(mod.28.fit)
print(mi27[mi28$mi > 3.0,])


# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj28 <- lavaan.survey(lavaan.fit = mod.28.fit, survey.design = design) 
summary(fit.adj28, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj28, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi28adj <- modindices(fit.adj28)
print(mi28adj[mi28adj$mi > 3.0,])

# Test whether removal of pathway was justified
anova(fit.adj25, fit.adj28) 

```

Although the p-value anova appear non-significant, looking at the various absolute and incremental fit indices suggests that the link __Mean.Raup.Crick2 ~ Sp.Richness2__ should be retained, as it improves model-data fit.


# Final Attendance Model (Species Presence - Absence)

Based on the results, we believe model 25 is an accurate representation of the system. Therefore we present the nested version of model 25 as our final Attendance Model based on species presence-absence data. 

```{r Final P-A Att SEM}
# Chosen Attendance SEM (Presence-Absence)
# Model 25

mod.25.final <- 'Attendance2 ~ Zoo.Area.ha2 + Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2 + Sp.Richness2 + Zoo.Area.ha2'

# Fit model and generate model summary
mod.25.final.fit <- sem(mod.25.final, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.25.final.fit, rsq = TRUE)

# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj25.final <- lavaan.survey(lavaan.fit = mod.25.final.fit, survey.design = design) 
summary(fit.adj25.final, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj25.final, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

```
 
 
## Tests of Mediation 


It is clear from Model 25 that several pathways are mediated in the system. It is necessary to evaluate whether this mediation is appropriate by comparing models with complete, partial and no mediation. Here we show tests of mediation for four of these relationships. 

### Attendance2 ~ Zoo.Area.ha2

__Attendance2 ~ Zoo.Area.ha2__ is mediated by: __Total.Animals2 ~ Zoo.Area.ha2__. Below we compare models with complete (full) mediation, partial mediation (i.e. model 25) and no mediation. Results from this output suggest that partial mediation (model 25) is the superior model.

```{r Mediation1 Att SEM}

# Complete Mediation Model

FULL1 <- 'Attendance2 ~ Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2 + X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMass2'

FULL1.fit <- sem(FULL1, data = sem_attendance_data, fixed.x=FALSE)
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
FULL1.fitadj <- lavaan.survey(lavaan.fit = FULL1.fit, survey.design = design)

# Partial Mediation Model (MOdel 25)

PARTIAL1.MOD25 <- 'Attendance2 ~ Zoo.Area.ha2 + Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2 + X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMass2'

PARTIAL1.MOD25.fit <- sem(PARTIAL1.MOD25, data = sem_attendance_data, fixed.x=FALSE)
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
PARTIAL1.MOD25.fitadj <- lavaan.survey(lavaan.fit = PARTIAL1.MOD25.fit, survey.design = design)

# No Mediation Model

NONE1 <- 'Attendance2 ~ Zoo.Area.ha2 + Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2 + X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMass2'

NONE1.fit <- sem(NONE1, data = sem_attendance_data, fixed.x=FALSE)
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
NONE1.fitadj <- lavaan.survey(lavaan.fit = NONE1.fit, survey.design = design)

aictab.lavaan(list(FULL1.fit, PARTIAL1.MOD25.fit, NONE1.fit, 
                   FULL1.fitadj, PARTIAL1.MOD25.fitadj, NONE1.fitadj), 
              c("full mediation", "partial mediation", "no mediation", "full mediation (nested)", "partial mediation (nested)", "no mediation (nested)"))

```

### Attendance2 ~ Total.Animals2

__Attendance2 ~ Total.Animals2__ is mediated by __Mean.Raup.Crick2 ~ Total.Animals2__. Below we compare models with complete (full) mediation, partial mediation (i.e. model 25) and no mediation. Results from this output suggest that partial mediation (model 25) is the superior model.


```{r Mediation2 Att SEM}

# Complete Mediation Model

FULL2 <- 'Attendance2 ~ Zoo.Area.ha2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2 + X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMass2'

FULL2.fit <- sem(FULL2, data = sem_attendance_data, fixed.x=FALSE)
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
FULL2.fitadj <- lavaan.survey(lavaan.fit = FULL2.fit, survey.design = design)

# Partial Mediation Model (Model 25)

PARTIAL2.MOD25 <- 'Attendance2 ~ Zoo.Area.ha2 + Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2 + X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMass2'

PARTIAL2.MOD25.fit <- sem(PARTIAL2.MOD25, data = sem_attendance_data, fixed.x=FALSE)
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
PARTIAL2.MOD25.fitadj <- lavaan.survey(lavaan.fit = PARTIAL2.MOD25.fit, survey.design = design)

# No Mediation Model

NONE2 <- 'Attendance2 ~ Zoo.Area.ha2 + Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2 + X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Sp.Richness2 + Mean.Sp.BodyMass2'

NONE2.fit <- sem(NONE2, data = sem_attendance_data, fixed.x=FALSE)
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
NONE2.fitadj <- lavaan.survey(lavaan.fit = NONE2.fit, survey.design = design)

aictab.lavaan(list(FULL2.fit, PARTIAL2.MOD25.fit, NONE2.fit, 
                   FULL2.fitadj, PARTIAL2.MOD25.fitadj, NONE2.fitadj), 
              c("full mediation", "partial mediation", "no mediation", "full mediation (nested)", "partial mediation (nested)", "no mediation (nested)"))

```

### Attendance2 ~ Mean.Sp.BodyMass2

__Attendance2 ~ Mean.Sp.BodyMass2__ is mediated by __Mean.Raup.Crick2 ~ Mean.Sp.BodyMass2__. Below we compare models with complete (full) mediation, partial mediation (i.e. model 25) and no mediation. Results from this output suggest that partial mediation (model 25) is the superior model.


```{r Mediation3 Att SEM}

# Complete Mediation Model 

FULL3 <- 'Attendance2 ~ Zoo.Area.ha2 + Total.Animals2
+ Mean.Raup.Crick2 + X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMass2'

FULL3.fit <- sem(FULL3, data = sem_attendance_data, fixed.x=FALSE)
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
FULL3.fitadj <- lavaan.survey(lavaan.fit = FULL3.fit, survey.design = design)

# Partial Mediation Model

PARTIAL3.MOD25 <- 'Attendance2 ~ Zoo.Area.ha2 + Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2 + X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMass2'

PARTIAL3.MOD25.fit <- sem(PARTIAL3.MOD25, data = sem_attendance_data, fixed.x=FALSE)
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
PARTIAL3.MOD25.fitadj <- lavaan.survey(lavaan.fit = PARTIAL3.MOD25.fit, survey.design = design)

# No Mediation Model

NONE3 <- 'Attendance2 ~ Zoo.Area.ha2 + Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2 + X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2'

NONE3.fit <- sem(NONE3, data = sem_attendance_data, fixed.x=FALSE)
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
NONE3.fitadj <- lavaan.survey(lavaan.fit = NONE3.fit, survey.design = design)

aictab.lavaan(list(FULL3.fit, PARTIAL3.MOD25.fit, NONE3.fit, 
                   FULL3.fitadj, PARTIAL3.MOD25.fitadj, NONE3.fitadj), 
              c("full mediation", "partial mediation", "no mediation", "full mediation (nested)", "partial mediation (nested)", "no mediation (nested)"))

```

### Attendance2 ~ GDP.Millions2

__Attendance2 ~ GDP.Millions2__ is mediated by __Total.Animals2 ~ GDP.Millions2__. Below we compare models with complete (full) mediation, partial mediation (i.e. model 25) and no mediation. Results from this output suggest that partial mediation (model 25) is the superior model.


```{r Mediation4 Att SEM}

# Complete Mediation Model

FULL4 <- 'Attendance2 ~ Zoo.Area.ha2 + Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMass2'

FULL4.fit <- sem(FULL4, data = sem_attendance_data, fixed.x=FALSE)
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
FULL4.fitadj <- lavaan.survey(lavaan.fit = FULL4.fit, survey.design = design)

# Partial Mediation Model (Model 25)

PARTIAL4.MOD25 <- 'Attendance2 ~ Zoo.Area.ha2 + Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2 + X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMass2'

PARTIAL4.MOD25.fit <- sem(PARTIAL4.MOD25, data = sem_attendance_data, fixed.x=FALSE)
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
PARTIAL4.MOD25.fitadj <- lavaan.survey(lavaan.fit = PARTIAL4.MOD25.fit, survey.design = design)

# No Mediation Model

NONE4 <- 'Attendance2 ~ Zoo.Area.ha2 + Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2 + X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMass2'

NONE4.fit <- sem(NONE4, data = sem_attendance_data, fixed.x=FALSE)
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
NONE4.fitadj <- lavaan.survey(lavaan.fit = NONE4.fit, survey.design = design)

aictab.lavaan(list(FULL4.fit, PARTIAL4.MOD25.fit, NONE4.fit, 
                   FULL4.fitadj, PARTIAL4.MOD25.fitadj, NONE4.fitadj), 
              c("full mediation", "partial mediation", "no mediation", "full mediation (nested)", "partial mediation (nested)", "no mediation (nested)"))


```


## Validation

Model validation is a process to provide more evidence for the selected model (Fan _et al.,_ 2016), yet it is often overlooked or not reported in SEM studies. It is achieved by testing the model with two or more random datasets from the same sample to ensure paramater estimates are similar when a model is based on different datasets from the same population. Here we validate our model using four random subsets (n = 200 each time) of the existing dataset. 


## Validation Set 1

Parameter estimates relatively constant (some p-value differences).

```{r Valid1 P-A Att SEM}
# Chosen Attendance SEM (Presence-Absence)
# Model 25

mod.25.final <- 'Attendance2 ~ Zoo.Area.ha2 + Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2 + Sp.Richness2 + Zoo.Area.ha2'

# Fit model and generate model summary
mod.25.final.fit <- sem(mod.25, data = validationset1, fixed.x=FALSE)
summary(mod.25.final.fit, rsq = TRUE)

# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=validationset1)
fit.adj25.final <- lavaan.survey(lavaan.fit = mod.25.final.fit, survey.design = design) 
summary(fit.adj25.final, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj25.final, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

```

## Validation Set 2

Parameter estimates relatively constant (some p-value differences).

```{r Valid2 P-A Att SEM}
# Chosen Attendance SEM (Presence-Absence)
# Model 25

mod.25.final <- 'Attendance2 ~ Zoo.Area.ha2 + Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2 + Sp.Richness2 + Zoo.Area.ha2'

# Fit model and generate model summary
mod.25.final.fit <- sem(mod.25, data = validationset2, fixed.x=FALSE)
summary(mod.25.final.fit, rsq = TRUE)

# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=validationset2)
fit.adj25.final <- lavaan.survey(lavaan.fit = mod.25.final.fit, survey.design = design) 
summary(fit.adj25.final, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj25.final, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

```

## Validation Set 3

Parameter estimates relatively constant (some p-value differences).

```{r Valid3 P-A Att SEM}
# Chosen Attendance SEM (Presence-Absence)
# Model 25

mod.25.final <- 'Attendance2 ~ Zoo.Area.ha2 + Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2 + Sp.Richness2 + Zoo.Area.ha2'

# Fit model and generate model summary
mod.25.final.fit <- sem(mod.25, data = validationset3, fixed.x=FALSE)
summary(mod.25.final.fit, rsq = TRUE)

# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=validationset3)
fit.adj25.final <- lavaan.survey(lavaan.fit = mod.25.final.fit, survey.design = design) 
summary(fit.adj25.final, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj25.final, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

```

## Validation Set 4

Parameter estimates relatively constant (some p-value differences).

```{r Valid4 P-A Att SEM}
# Chosen Attendance SEM (Presence-Absence)
# Model 25

mod.25.final <- 'Attendance2 ~ Zoo.Area.ha2 + Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2 + Sp.Richness2 + Zoo.Area.ha2'

# Fit model and generate model summary
mod.25.final.fit <- sem(mod.25, data = validationset4, fixed.x=FALSE)
summary(mod.25.final.fit, rsq = TRUE)

# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=validationset4)
fit.adj25.final <- lavaan.survey(lavaan.fit = mod.25.final.fit, survey.design = design) 
summary(fit.adj25.final, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj25.final, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

```
 
 
Across all the validation models while we see some differences regarding p-values, as would be expected we see qualitatively similar parameter estimates across the four validation sets.
 
 
 
# Attendance SEM 

Two models were developed, one based on species presence-absence per institution and the the other which also conisdered species' population sizes per institution. This was important for calculating mean species body mass per institution, the proportion of threatened species per institution etc. Here we develop the model based on species abundance. Species abundance was incorporated into the following metrics: Mean species body mass per institution, the proportion of mammals per institution and the proportion of threatened species per institution. 

# Species Abundance
## Model 1 (a priori meta-model)

We now define our starting model for the SEM based on the a priori meta-model which is constructed based on evidence from the litrature and combined with proposed causal hypotheses. This model includes all previously identified evidence-based relationships and the numerous proposed causal pathways to visitor attendance. The development of this model can be found in the Supplementary information.

```{r 1.1st Att SEM Abund}
# Attendance SEM (Species Abundance)

# Model 1
# Based on a priori meta-model and proposed causal pathways

mod.1A <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Abdun2 + Prop.Threat.Abund2
+ Mean.Sp.BodyMassXAbund2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2 + GDP.Millions2 + Nat_Pop._WB20152

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Zoo.Area.ha2 + Prop.Mam.Sp2
Prop.Threat.Abund2 ~ Brillouin.Index2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2'

```

We then fit the model, generate the model summary and generate a selection of absolute fit indices (e.g. Standardized Root Mean Square Residual) and incremental fit indices (e.g. Comparative Fit Index), to account for the differential sensitivity of fit indices to data distribution, model size and sample size (Hu & Bentler, 1999). We then generate modification indices to identify suspected pathways for inclusion, with a standard cut-off level for the chi-square test criterion of 3.84 (Burnham and Anderson, 2002).

Given the nested nature of the data (institutions within countries), we then adjust the model design to take this into considerdation. This is done using the lavaan.survey package. Once again, the model summary, fit indices and modification indices were all generated. 

```{r 1.2st Att SEM Abund fit}
# Fit model and generate model summary
mod.1A.fit <- sem(mod.1A, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.1A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.1A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi1A <- modindices(mod.1A.fit)
print(mi1A[mi1A$mi > 3.0,])


# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj1A <- lavaan.survey(lavaan.fit = mod.1A.fit, survey.design = design)
summary(fit.adj1A, rsq = TRUE)


# Generate fit indices
fitMeasures(fit.adj1A, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi1adjA <- modindices(fit.adj1A)
print(mi1adjA[mi1adjA$mi > 3.0,])


```

## Model 2 

Based on the modification indices generated from the first model, we can see that __Sp.Richness2  ~  Mam.Sp.Richness2__ has the highest mi value of __349.340__. This far exceeds the standard cut-off level for the chi-square test criterion of 3.84 (Burnham and Anderson, 2002). This is also one of the most intuitive relationships, as if we increase mammal species richness, then of course we are going to increase overall species richness simulataneously. As a result, we add this relationship to our model. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 2nd Att SEM Abund}
# Attendance SEM (Species Abundance)

# Model 2
# Addition of Sp.Richness2 ~ Mam.Sp.Richness2, mi = 349.342

mod.2A <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Abdun2 + Prop.Threat.Abund2
+ Mean.Sp.BodyMassXAbund2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2 + GDP.Millions2 + Nat_Pop._WB20152

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Zoo.Area.ha2 + Prop.Mam.Sp2 + Mam.Sp.Richness2
Prop.Threat.Abund2 ~ Brillouin.Index2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2'

# Fit model and generate model summary
mod.2A.fit <- sem(mod.2A, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.2A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.2A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi2A <- modindices(mod.2A.fit)
print(mi2A[mi2A$mi > 3.0,])

# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj2A <- lavaan.survey(lavaan.fit = mod.2A.fit, survey.design = design) 
summary(fit.adj2A, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj2A, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi2adjA <- modindices(fit.adj2A)
print(mi2adjA[mi2adjA$mi > 3.0,])

```

## Model 3 

Based on the modification indices generated from the second model, we can see that __Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2__ has an mi value of __96.529__. This is the second highest mi value and far exceeds the standard cut-off level for the chi-square test criterion of 3.84 (Burnham and Anderson, 2002). This is also one of the most intuitive relationships, as if we increase the body mass of the animals in a collection, then ultimately the collection will be able to house fewer of them (due to the increased space requirements). This reduction in available spaces will mean it is more likely that the collection composition will overlap with other institutions. As a result, we add this relationship to our model. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 



```{r 3rd Att SEM Abund}
# Attendance SEM (Species Abundance)

# Model 3
# Addition of Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2, mi = 96.529

mod.3A <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Abdun2 + Prop.Threat.Abund2
+ Mean.Sp.BodyMassXAbund2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2 + GDP.Millions2 + Nat_Pop._WB20152

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Zoo.Area.ha2 + Prop.Mam.Sp2 + Mam.Sp.Richness2
Prop.Threat.Abund2 ~ Brillouin.Index2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMassXAbund2'

# Fit model and generate model summary
mod.3A.fit <- sem(mod.3A, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.3A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.3A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi3A <- modindices(mod.3A.fit)
print(mi3A[mi3A$mi > 3.0,])

# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj3A <- lavaan.survey(lavaan.fit = mod.3A.fit, survey.design = design) 
summary(fit.adj3A, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj3A, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi3adjA <- modindices(fit.adj3A)
print(mi3adjA[mi3adjA$mi > 3.0,])

```


## Model 4 

Based on the modification indices generated from the third model, we can see that __Brillouin.Index2 ~ GDP.Millions2__ has an mi value of __58.529__. This is the highest mi value and far exceeds the standard cut-off level for the chi-square test criterion of 3.84 (Burnham and Anderson, 2002). This also makes theoretical sense, as it is logical to assume that countries with a higher GDP can afford to have much more diverse zoological collections. There is likely a historical element also at play here, however this is beyond what is deducible from the data available. As a result, we add this relationship to our model. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data.. 


```{r 4th Att SEM Abund}
# Attendance SEM (Species Abundance)

# Model 4
# Addition of Brillouin.Index2 ~ GDP.Millions2, mi = 58.529

mod.4A <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Abdun2 + Prop.Threat.Abund2
+ Mean.Sp.BodyMassXAbund2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2 + GDP.Millions2 + Nat_Pop._WB20152

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Zoo.Area.ha2 + Prop.Mam.Sp2 + Mam.Sp.Richness2
Prop.Threat.Abund2 ~ Brillouin.Index2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2 + GDP.Millions2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMassXAbund2'

# Fit model and generate model summary
mod.4A.fit <- sem(mod.4A, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.4A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.4A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi4A <- modindices(mod.4A.fit)
print(mi4A[mi4A$mi > 3.0,])

# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj4A <- lavaan.survey(lavaan.fit = mod.4A.fit, survey.design = design) 
summary(fit.adj4A, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj4A, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi4adjA <- modindices(fit.adj4A)
print(mi4adjA[mi4adjA$mi > 3.0,])

```

## Model 5

Based on the modification indices generated from the fourth model, we can see that __Mean.Raup.Crick2 ~ Prop.Mam.Sp2__ has an mi value of __37.344__. This is the highest mi value and far exceeds the standard cut-off level for the chi-square test criterion of 3.84 (Burnham and Anderson, 2002). This also makes theoretical sense, as contemporary zoological collections are taxonomically biased towards mammals, therefore if an institution has a high proportion of mammals it is more likely to have more overlap with other collections. As a result, we add this relationship to our model. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data.


```{r 5th Att SEM Abund}
# Attendance SEM (Species Abundance)

# Model 5
# Addition of Mean.Raup.Crick2 ~ Prop.Mam.Sp2, mi = 37.344

mod.5A <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Abdun2 + Prop.Threat.Abund2
+ Mean.Sp.BodyMassXAbund2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2 + GDP.Millions2 + Nat_Pop._WB20152

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Zoo.Area.ha2 + Prop.Mam.Sp2 + Mam.Sp.Richness2
Prop.Threat.Abund2 ~ Brillouin.Index2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2 + GDP.Millions2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMassXAbund2 + Prop.Mam.Sp2'

# Fit model and generate model summary
mod.5A.fit <- sem(mod.5A, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.5A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.5A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi5A <- modindices(mod.5A.fit)
print(mi5A[mi5A$mi > 3.0,])

# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj5A <- lavaan.survey(lavaan.fit = mod.5A.fit, survey.design = design) 
summary(fit.adj5A, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj5A, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi5adjA <- modindices(fit.adj5A)
print(mi5adjA[mi5adjA$mi > 3.0,])

```


## Model 6

Based on the modification indices generated from the fifth model, we can see that __Total.Animals2 ~ Mean.Sp.BodyMassXAbund2__ has an mi value of __24.303__. This is one of the highest mi values and far exceeds the standard cut-off level for the chi-square test criterion of 3.84 (Burnham and Anderson, 2002). This is also a conceptually appealling addition, as it is logical to assume that if we increase the body mass of the species within a collection, then owing to their increased space requirements, the total number of animals capabale of being maintained would be reduced. As a result, we add this relationship to our model. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data.


```{r 6th Att SEM Abund}
# Attendance SEM (Species Abundance)

# Model 6
# Addition of Total.Animals2 ~ Mean.Sp.BodyMassXAbund2, mi = 24.303

mod.6A <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Abdun2 + Prop.Threat.Abund2
+ Mean.Sp.BodyMassXAbund2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2 + GDP.Millions2 + Nat_Pop._WB20152

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Sp.Richness2 ~ Zoo.Area.ha2 + Prop.Mam.Sp2 + Mam.Sp.Richness2
Prop.Threat.Abund2 ~ Brillouin.Index2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2 + GDP.Millions2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMassXAbund2 + Prop.Mam.Sp2'

# Fit model and generate model summary
mod.6A.fit <- sem(mod.6A, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.6A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.6A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi6A <- modindices(mod.6A.fit)
print(mi6A[mi6A$mi > 3.0,])

# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj6A <- lavaan.survey(lavaan.fit = mod.6A.fit, survey.design = design) 
summary(fit.adj6A, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj6A, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi6adjA <- modindices(fit.adj6A)
print(mi6adjA[mi6adjA$mi > 3.0,])

```


## Model 7

Based on the modification indices generated from the sixth model, we can see that __Total.Animals2 ~ GDP.Millions2__ has an mi value of __35.428__. This is one of the highest mi values and far exceeds the standard cut-off level for the chi-square test criterion of 3.84 (Burnham and Anderson, 2002). Although not the highest mi value, this is the most intuitive and still exceeds the standard cut-off level for the chi-square test criterion of 3.84 (Burnham and Anderson, 2002). This is considered intuituive as it is logical to assume that countries with a higher GDP can afford to have zoological collections with many more animals. Again, the exact reasoning behind this is likely rooted in an historical context that exceeds the scope of this work. As a result, we add this relationship to our model. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data.


```{r 7th Att SEM Abund}
# Attendance SEM (Species Abundance)

# Model 7
# Addition of Total.Animals2 ~ GDP.Millions2, mi = 35.428

mod.7A <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Abdun2 + Prop.Threat.Abund2
+ Mean.Sp.BodyMassXAbund2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2 + GDP.Millions2 + Nat_Pop._WB20152

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + GDP.Millions2
Sp.Richness2 ~ Zoo.Area.ha2 + Prop.Mam.Sp2 + Mam.Sp.Richness2
Prop.Threat.Abund2 ~ Brillouin.Index2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2 + GDP.Millions2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMassXAbund2 + Prop.Mam.Sp2'

# Fit model and generate model summary
mod.7A.fit <- sem(mod.7A, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.7A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.7A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi7A <- modindices(mod.7A.fit)
print(mi7A[mi7A$mi > 3.0,])

# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj7A <- lavaan.survey(lavaan.fit = mod.7A.fit, survey.design = design) 
summary(fit.adj7A, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj7A, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi7adjA <- modindices(fit.adj7A)
print(mi7adjA[mi7adjA$mi > 3.0,])

```

## Model Comparisons

At this stage we compare the models generated using AICc values. Overall model selection from the pool of competing models is achieved using AICc values, with a threshold of more than 2 AICc units lower than nearest competing model being considered sufficient for model selection. 

```{r 1st AICc SEM Abund}
# Model Comparisons using AICc

# Comparing models with and without adjustment for nested nature of data
# library(AICcmodavg) 
# source("lavaan.modavg.R")

aictab.lavaan(list(mod.1A.fit, mod.2A.fit, mod.3A.fit, mod.4A.fit, mod.5A.fit, mod.6A.fit, mod.7A.fit, fit.adj1A, fit.adj2A, fit.adj3A, fit.adj4A, fit.adj5A, fit.adj6A, fit.adj7A), 
              c("mod.1A", "mod.2A", "mod.3A", "mod.4A", "mod.5A", "mod.6A", "mod.7A","mod.1A.nested", "mod.2A.nested", "mod.3A.nested", "mod.4A.nested", "mod.5A.nested", "mod.6A.nested", "mod.7A.nested"))

```

Based on these results we can see that model 7 is the superior model (lowest AICc values), for both models with and without adjustment for nested nature of data. 

At this stage no other addition is conceptually appealling. Now we use p-values to identify potentially unsupported pathways, with a threshold of 0.05. Highest p-values are considered first for removal.

## Model 8

Based on the results generated from the nested seventh model, the highest p-value relationship to be considered for removal is __Attendance2 ~ Brilloun.Indx2__ with a p-value of __0.710__. Therefore we decide to remove this pathway. Based on the Presence-Absence model results and the fact that Brillouin Index is no longer contributing to visitor attendance, it was decided to remove the variable from the analysis completely in a semi-exploratory manner (similar to the Presence-Absence model). Therefore we decide to remove the pathways associated with this variable. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 8th Att SEM Abund}
# Attendance SEM (Species Abundance)

# Model 8
# Removal of Attendance2 ~ Brilloun.Indx2, p = 0.710 (and subsequently Brilloun.Indx2 completely)

mod.8A <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Abdun2 + Prop.Threat.Abund2
+ Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2 + GDP.Millions2 + Nat_Pop._WB20152

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + GDP.Millions2
Sp.Richness2 ~ Zoo.Area.ha2 + Prop.Mam.Sp2 + Mam.Sp.Richness2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMassXAbund2 + Prop.Mam.Sp2'

# Fit model and generate model summary
mod.8A.fit <- sem(mod.8A, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.8A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.8A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi8A <- modindices(mod.8A.fit)
print(mi8A[mi8A$mi > 3.0,])

# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj8A <- lavaan.survey(lavaan.fit = mod.8A.fit, survey.design = design) 
summary(fit.adj8A, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj8A, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi8adjA <- modindices(fit.adj8A)
print(mi8adjA[mi8adjA$mi > 3.0,])

```

## Model 9

Based on the results generated from the nested eight model, the highest p-value relationship to be considered for removal is __Attendance2 ~ Prp.Thrt.Abnd2__ with a p-value of __0.468__. Therefore we decide to remove this pathway. As this is the only link involving Prp.Thrt.Abnd2, this also means Prp.Thrt.Abnd2 is subsequently removed from this model.Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 9th Att SEM Abund}
# Attendance SEM (Species Abundance)

# Model 9
# Removal of Attendance2 ~ Prp.Thrt.Abnd2, p = 0.468 (and subsequently Prp.Thrt.Abnd2 completely)

mod.9A <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Abdun2 
+ Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2 + GDP.Millions2 + Nat_Pop._WB20152

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + GDP.Millions2
Sp.Richness2 ~ Zoo.Area.ha2 + Prop.Mam.Sp2 + Mam.Sp.Richness2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMassXAbund2 + Prop.Mam.Sp2'

# Fit model and generate model summary
mod.9A.fit <- sem(mod.9A, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.9A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.9A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi9A <- modindices(mod.9A.fit)
print(mi9A[mi9A$mi > 3.0,])

# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj9A <- lavaan.survey(lavaan.fit = mod.9A.fit, survey.design = design) 
summary(fit.adj9A, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj9A, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi9adjA <- modindices(fit.adj9A)
print(mi9adjA[mi9adjA$mi > 3.0,])

```


## Model 10

Based on the results generated from the nested ninth model, the highest p-value relationship to be considered for removal is __Sp.Richness2 ~ Zoo.Area.ha2__ with a p-value of __0.129__. Therefore we decide to remove this pathway. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 10th Att SEM Abund}
# Attendance SEM (Species Abundance)

# Model 10
# Removal of Sp.Richness2 ~ Zoo.Area.ha2, p = 0.129 

mod.10A <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Abdun2 
+ Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2 + GDP.Millions2 + Nat_Pop._WB20152

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + GDP.Millions2
Sp.Richness2 ~ Prop.Mam.Sp2 + Mam.Sp.Richness2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMassXAbund2 + Prop.Mam.Sp2'

# Fit model and generate model summary
mod.10A.fit <- sem(mod.10A, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.10A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.10A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi10A <- modindices(mod.10A.fit)
print(mi10A[mi10A$mi > 3.0,])

# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj10A <- lavaan.survey(lavaan.fit = mod.10A.fit, survey.design = design) 
summary(fit.adj10A, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj10A, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi10adjA <- modindices(fit.adj10A)
print(mi10adjA[mi10adjA$mi > 3.0,])

```

## Model 11

Based on the results generated from the nested tenth model, the highest p-value relationship to be considered for removal is __Attendance2 ~ Zoo.Area.ha2__ with a p-value of __0.055__. Therefore we decide to remove this pathway. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 11th Att SEM Abund}
# Attendance SEM (Species Abundance)

# Model 11
# Removal of Attendance2 ~ Zoo.Area.ha2, p = 0.055

mod.11A <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Abdun2 
+ Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2 + GDP.Millions2 + Nat_Pop._WB20152

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + GDP.Millions2
Sp.Richness2 ~ Prop.Mam.Sp2 + Mam.Sp.Richness2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMassXAbund2 + Prop.Mam.Sp2'

# Fit model and generate model summary
mod.11A.fit <- sem(mod.11A, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.11A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.11A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi11A <- modindices(mod.11A.fit)
print(mi11A[mi11A$mi > 3.0,])

# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj11A <- lavaan.survey(lavaan.fit = mod.11A.fit, survey.design = design) 
summary(fit.adj11A, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj11A, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi11adjA <- modindices(fit.adj11A)
print(mi11adjA[mi11adjA$mi > 3.0,])

```

## Model 12

Based on the results generated from the nested eleventh model, the highest p-value relationship to be considered for removal is __Attendance2 ~ Nt_Pp._WB20152__ with a p-value of __0.077__. Therefore we decide to remove this pathway. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 12th Att SEM Abund}
# Attendance SEM (Species Abundance)

# Model 12
# Removal of Attendance2 ~ Nt_Pp._WB20152, p = 0.077

mod.12A <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Abdun2 
+ Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + GDP.Millions2
Sp.Richness2 ~ Prop.Mam.Sp2 + Mam.Sp.Richness2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMassXAbund2 + Prop.Mam.Sp2'

# Fit model and generate model summary
mod.12A.fit <- sem(mod.12A, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.12A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.12A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi12A <- modindices(mod.12A.fit)
print(mi12A[mi12A$mi > 3.0,])

# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj12A <- lavaan.survey(lavaan.fit = mod.12A.fit, survey.design = design) 
summary(fit.adj12A, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj12A, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi12adjA <- modindices(fit.adj12A)
print(mi12adjA[mi12adjA$mi > 3.0,])

```

## Model 13

Based on the results generated from the nested twelfth model, the highest p-value relationship to be considered for removal is __Attendance2 ~ X50km_Pop2__ with a p-value of __0.066__. Therefore we decide to remove this pathway. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 13th Att SEM Abund}
# Attendance SEM (Species Abundance)

# Model 13
# Removal of Attendance2 ~ X50km_Pop2, p = 0.066

mod.13A <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Abdun2 
+ Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + GDP.Millions2
Sp.Richness2 ~ Prop.Mam.Sp2 + Mam.Sp.Richness2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMassXAbund2 + Prop.Mam.Sp2'

# Fit model and generate model summary
mod.13A.fit <- sem(mod.13A, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.13A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.13A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi13A <- modindices(mod.13A.fit)
print(mi13A[mi13A$mi > 3.0,])

# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj13A <- lavaan.survey(lavaan.fit = mod.13A.fit, survey.design = design) 
summary(fit.adj13A, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj13A, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi13adjA <- modindices(fit.adj13A)
print(mi13adjA[mi13adjA$mi > 3.0,])

```


## Model 14

At this stage it was decided to remove the link __Attendance2 ~ Prop.Mam.Abdn2__ from the analysis, as it adds little extra information than that provided by __Mam.Sp.Richness2__. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 14th Att SEM Abund}
# Attendance SEM (Species Abundance)

# Model 14
# Removal of Attendance2 ~ Prop.Mam.Abdun2

mod.14A <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + GDP.Millions2
Sp.Richness2 ~ Prop.Mam.Sp2 + Mam.Sp.Richness2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMassXAbund2 + Prop.Mam.Sp2'

# Fit model and generate model summary
mod.14A.fit <- sem(mod.14A, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.14A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.14A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi14A <- modindices(mod.14A.fit)
print(mi14A[mi14A$mi > 3.0,])

# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj14A <- lavaan.survey(lavaan.fit = mod.14A.fit, survey.design = design) 
summary(fit.adj14A, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj14A, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi14adjA <- modindices(fit.adj14A)
print(mi14adjA[mi14adjA$mi > 3.0,])

```

## Model Comparisons

At this stage we compare the models generated using AICc values. Overall model selection from the pool of competing models is achieved using AICc values, with a threshold of more than 2 AICc units lower than nearest competing model being considered sufficient for model selection. 

```{r 2nd AICc SEM Abund}
# Model Comparisons using AICc

# Comparing models with and without adjustment for nested nature of data
# library(AICcmodavg) 
# source("lavaan.modavg.R")

aictab.lavaan(list(mod.1A.fit, mod.2A.fit, mod.3A.fit, mod.4A.fit, mod.5A.fit, mod.6A.fit, mod.7A.fit, mod.8A.fit, mod.9A.fit, mod.10A.fit, mod.11A.fit, mod.12A.fit, mod.13A.fit, mod.14A.fit, fit.adj1A, fit.adj2A, fit.adj3A, fit.adj4A, fit.adj5A, fit.adj6A, fit.adj7A, fit.adj8A,fit.adj9A, fit.adj10A, fit.adj11A, fit.adj12A, fit.adj13A, fit.adj14A), 
              c("mod.1A", "mod.2A", "mod.3A", "mod.4A", "mod.5A", "mod.6A", "mod.7A", "mod.8A", 
                "mod.9A", "mod.10A", "mod.11A", "mod.12A", "mod.13A", "mod.14A", "mod.1A.nested",
                "mod.2A.nested", "mod.3A.nested", "mod.4A.nested", "mod.5A.nested", "mod.6A.nested", "mod.7A.nested", "mod.8A.nested", "mod.9A.nested", "mod.10A.nested", "mod.11A.nested", "mod.12A.nested", "mod.13A.nested", "mod.14A.nested"))

```

Based on these results we can see that model 14 is the superior model (lowest AICc values), for both models with and without adjustment for nested nature of data. 

## Model 15

At this stage it was decided to remove the link __Sp.Richness2 ~ Prop.Mam.Sp2__ from the analysis, as it adds little extra information than that provided by __Mam.Sp.Richness2__. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 15th Att SEM Abund}
# Attendance SEM (Species Abundance)

# Model 15
# Removal of Sp.Richness2 ~ Prop.Mam.Sp2

mod.15A <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMassXAbund2'

# Fit model and generate model summary
mod.15A.fit <- sem(mod.15A, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.15A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.15A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi15A <- modindices(mod.15A.fit)
print(mi15A[mi15A$mi > 3.0,])

# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj15A <- lavaan.survey(lavaan.fit = mod.15A.fit, survey.design = design) 
summary(fit.adj15A, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj15A, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi15adjA <- modindices(fit.adj15A)
print(mi15adjA[mi15adjA$mi > 3.0,])

```



## Model 16


Based on the modification indices generated from the fifteenth model, we can see that __Sp.Richness2 ~ Mean.Sp.BodyMassXAbund2__ has the highest mi value of __137.040__. This far exceeds the standard cut-off level for the chi-square test criterion of 3.84 (Burnham and Anderson, 2002). This is also one of the most intuitive relationships within the system. There is clear evidence within the literature that zoological institutions have a limited carrying capacity and that large vertebrates, by their very nature, require ever larger enclosure sizes. Therefore it is deducible that institutions with larger vertebrates will be able to hold fewer species. This semi-exploratory modelling approach is similar to that implemented in Grace _et al.,_ 2016. As a result, we add this relationship to our model. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 16th Att SEM Abund}
# Attendance SEM (Species Abundance)

# Model 16
# Addition of Sp.Richness2 ~ Mean.Sp.BodyMassXAbund2, mi = 137.040

mod.16A <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMassXAbund2'

# Fit model and generate model summary
mod.16A.fit <- sem(mod.16A, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.16A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.16A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi16A <- modindices(mod.16A.fit)
print(mi16A[mi16A$mi > 3.0,])

# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj16A <- lavaan.survey(lavaan.fit = mod.16A.fit, survey.design = design) 
summary(fit.adj16A, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj16A, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi16adjA <- modindices(fit.adj16A)
print(mi16adjA[mi16adjA$mi > 3.0,])

```


## Model 17

Based on the results generated from the nested sixteenth model, the highest p-value relationship to be considered for removal is __Mean.Raup.Crick2 ~ Sp.Richness2__ with a p-value of __0.255__. As a result, we remove this relationship from our model. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 17th Att SEM Abund}
# Attendance SEM (Species Abundance)

# Model 17
# Removal of Mean.Raup.Crick2 ~ Sp.Richness2, p = 0.255

mod.17A <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMassXAbund2'

# Fit model and generate model summary
mod.17A.fit <- sem(mod.17A, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.17A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.17A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi17A <- modindices(mod.17A.fit)
print(mi17A[mi17A$mi > 3.0,])

# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj17A <- lavaan.survey(lavaan.fit = mod.17A.fit, survey.design = design) 
summary(fit.adj17A, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj17A, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi17adjA <- modindices(fit.adj17A)
print(mi17adjA[mi17adjA$mi > 3.0,])

```


## Model 18

Based on the modification indices generated from the nested seventeenth model, we can see that __Sp.Richness2 ~ Zoo.Area.ha2__ has an mi value of __8.322__. This is one of the highest mi values and far exceeds the standard cut-off level for the chi-square test criterion of 3.84 (Burnham and Anderson, 2002). Although not the highest mi value, this is the most intuitive and still exceeds the standard cut-off level for the chi-square test criterion of 3.84 (Burnham and Anderson, 2002). This is considered intuituive as it is logical to assume that the size of an institution will influence how many species it can maintain. As a result, we add this relationship to our model. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 18th Att SEM Abund}
# Attendance SEM (Species Abundance)

# Model 18
# Addition of Sp.Richness2 ~ Zoo.Area.ha2, mi = 8.322

mod.18A <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMassXAbund2'

# Fit model and generate model summary
mod.18A.fit <- sem(mod.18A, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.18A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.18A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi18A <- modindices(mod.18A.fit)
print(mi18A[mi18A$mi > 3.0,])

# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj18A <- lavaan.survey(lavaan.fit = mod.18A.fit, survey.design = design) 
summary(fit.adj18A, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj18A, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi18adjA <- modindices(fit.adj18A)
print(mi18adjA[mi18adjA$mi > 3.0,])

```


## Model 19

Based on the modification indices generated from the nested seventeenth model, we can see that __Mean.Raup.Crick2 ~ Zoo.Area.ha2__ has an mi value of __16.351__. This is one of the highest mi values and far exceeds the standard cut-off level for the chi-square test criterion of 3.84 (Burnham and Anderson, 2002). Although not the highest mi value, this is the most intuitive and still exceeds the standard cut-off level for the chi-square test criterion of 3.84 (Burnham and Anderson, 2002). This is considered intuituive as it is logical to assume that the size of an institution will influence how many species it can maintain. As a result, we add this relationship to our model. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 19th Att SEM Abund}
# Attendance SEM (Species Abundance)

# Model 19
# Addition of Mean.Raup.Crick2 ~ Zoo.Area.ha2, mi = 16.352

mod.19A <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2'

# Fit model and generate model summary
mod.19A.fit <- sem(mod.19A, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.19A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.19A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi19A <- modindices(mod.19A.fit)
print(mi19A[mi19A$mi > 3.0,])

# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj19A <- lavaan.survey(lavaan.fit = mod.19A.fit, survey.design = design) 
summary(fit.adj19A, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj19A, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi19adjA <- modindices(fit.adj19A)
print(mi19adjA[mi19adjA$mi > 3.0,])

```


## Model 20

Based on the results generated from the nested nineteenth model, the highest p-value relationship to be considered for removal is __Mean.Raup.Crick2 ~ Total.Animals2__ with a p-value of __0.201__. As a result, we remove this relationship from our model. Once again, the model summary, fit indices and modification indices were all generated for the model, adjusting for the nested nature of data. 


```{r 20th Att SEM Abund}
# Attendance SEM (Species Abundance)

# Model 20
# Removal of Mean.Raup.Crick2 ~ Total.Animals2, p = 0.201

mod.20A <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2'

# Fit model and generate model summary
mod.20A.fit <- sem(mod.20A, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.20A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.20A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi20A <- modindices(mod.20A.fit)
print(mi20A[mi20A$mi > 3.0,])

# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj20A <- lavaan.survey(lavaan.fit = mod.20A.fit, survey.design = design) 
summary(fit.adj20A, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj20A, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
mi20adjA <- modindices(fit.adj20A)
print(mi20adjA[mi20adjA$mi > 3.0,])

```


## Model Comparisons

At this stage we compare the models generated using AICc values. Overall model selection from the pool of competing models is achieved using AICc values, with a threshold of more than 2 AICc units lower than nearest competing model being considered sufficient for model selection. 

```{r 3rd AICc SEM Abund}
# Model Comparisons using AICc

# Comparing models with and without adjustment for nested nature of data
# library(AICcmodavg) 
# source("lavaan.modavg.R")

aictab.lavaan(list(mod.1A.fit, mod.2A.fit, mod.3A.fit, mod.4A.fit, mod.5A.fit, mod.6A.fit, mod.7A.fit, 
                   mod.8A.fit, mod.9A.fit, mod.10A.fit, mod.11A.fit, mod.12A.fit, mod.13A.fit, mod.14A.fit, 
                   mod.15A.fit, mod.16A.fit, mod.17A.fit, mod.18A.fit, mod.19A.fit, mod.20A.fit,fit.adj1A, fit.adj2A, 
                   fit.adj3A, fit.adj4A, fit.adj5A, fit.adj6A, fit.adj7A, fit.adj8A, fit.adj9A, fit.adj10A, 
                   fit.adj11A, fit.adj12A, fit.adj13A, fit.adj14A, fit.adj15A, fit.adj16A, fit.adj17A, 
                   fit.adj18A, fit.adj19A, fit.adj20A), 
              c("mod.1A", "mod.2A", "mod.3A", "mod.4A", "mod.5A", "mod.6A", "mod.7A", "mod.8A", 
                "mod.9A", "mod.10A", "mod.11A", "mod.12A", "mod.13A", "mod.14A", "mod.15A", "mod.16A", 
                "mod.17A", "mod.18A", "mod.19A", "mod.20A", "mod.1A.nested", "mod.2A.nested", "mod.3A.nested", "mod.4A.nested",  "mod.5A.nested", "mod.6A.nested", "mod.7A.nested", "mod.8A.nested", "mod.9A.nested", "mod.10A.nested", "mod.11A.nested", "mod.12A.nested", "mod.13A.nested", "mod.14A.nested", "mod.15A.nested", "mod.16A.nested", "mod.17A.nested", "mod.18A.nested", "mod.19A.nested", "mod.20A.nested"))

```

Based on these results we can see that model 20 is the superior model (lowest AICc values), for both models with and without adjustment for nested nature of data. Although model 19 has the lowest AIC, it isn't by 2 units compared to 20, so the addition of the pathway in model 19 is not justified. 


# Final Attendance Model (Species Abundance)

Based on the results, we believe model 20 is an accurate representation of the system. We see no conceptually appealling addition and all pathways are significant. Therefore we present the nested version of model 20 as our final Attendance Model based on species abundance data. 


```{r Final Att SEM Abund}
# Chosen Attendance SEM (Abundance)
# Model 20

mod.20A.final <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2'

# Fit model and generate model summary
mod.20A.final.fit <- sem(mod.20A.final, data = sem_attendance_data, fixed.x=FALSE)
summary(mod.20A.final.fit, rsq = TRUE)

# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
fit.adj20A.final <- lavaan.survey(lavaan.fit = mod.20A.final.fit, survey.design = design) 
summary(fit.adj20A.final, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj20A.final, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

```


## Tests of Mediation 


It is clear from Model 20 that several pathways are mediated in the system. It is necessary to evaluate whether this mediation is appropriate by comparing models with complete, partial and no mediation. Here we show tests of mediation for three of these relationships. 

### Attendance2 ~ Mean.Sp.BodyMassXAbund2

__Attendance2 ~ Mean.Sp.BodyMassXAbund2__ is mediated by __Total.Animals2 ~ Mean.Sp.BodyMassXAbund2__. Below we compare models with complete (full) mediation, partial mediation (i.e. model 20) and no mediation. Results from this output suggest that partial mediation (model 20) is the superior model.

```{r Mediation1 Att SEM Abund}

# Complete Mediation Model

FULL1A <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2'

FULL1A.fit <- sem(FULL1A, data = sem_attendance_data, fixed.x=FALSE)
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
FULL1A.fitadj <- lavaan.survey(lavaan.fit = FULL1A.fit, survey.design = design)

# Partial Mediation Model (MOdel 20)

PARTIAL1A.MOD20 <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2'

PARTIAL1A.MOD20.fit <- sem(PARTIAL1A.MOD20, data = sem_attendance_data, fixed.x=FALSE)
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
PARTIAL1A.MOD20.fitadj <- lavaan.survey(lavaan.fit = PARTIAL1A.MOD20.fit, survey.design = design)

# No Mediation Model

NONE1A <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2'

NONE1A.fit <- sem(NONE1A, data = sem_attendance_data, fixed.x=FALSE)
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
NONE1A.fitadj <- lavaan.survey(lavaan.fit = NONE1A.fit, survey.design = design)

aictab.lavaan(list(FULL1A.fit, PARTIAL1A.MOD20.fit, NONE1A.fit, 
                   FULL1A.fitadj, PARTIAL1A.MOD20.fitadj, NONE1A.fitadj), 
              c("full mediation", "partial mediation", "no mediation", "full mediation (nested)", "partial mediation (nested)", "no mediation (nested)"))

```

### Attendance2 ~ Mean.Sp.BodyMassXAbund2

__Attendance2 ~ Mean.Sp.BodyMassXAbund2__ is also mediated by __Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2__. Below we compare models with complete (full) mediation, partial mediation (i.e. model 20) and no mediation. Results from this output suggest that partial mediation (model 20) is the superior model.

```{r Mediation2 Att SEM Abund}

# Complete Mediation Model

FULL2A <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2'

FULL2A.fit <- sem(FULL2A, data = sem_attendance_data, fixed.x=FALSE)
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
FULL2A.fitadj <- lavaan.survey(lavaan.fit = FULL2A.fit, survey.design = design)

# Partial Mediation Model (MOdel 20)

PARTIAL2A.MOD20 <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2'

PARTIAL2A.MOD20.fit <- sem(PARTIAL2A.MOD20, data = sem_attendance_data, fixed.x=FALSE)
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
PARTIAL2A.MOD20.fitadj <- lavaan.survey(lavaan.fit = PARTIAL2A.MOD20.fit, survey.design = design)

# No Mediation Model

NONE2A <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Mean.Raup.Crick2 ~ Zoo.Area.ha2'

NONE2A.fit <- sem(NONE2A, data = sem_attendance_data, fixed.x=FALSE)
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
NONE2A.fitadj <- lavaan.survey(lavaan.fit = NONE2A.fit, survey.design = design)

aictab.lavaan(list(FULL2A.fit, PARTIAL2A.MOD20.fit, NONE2A.fit, 
                   FULL2A.fitadj, PARTIAL2A.MOD20.fitadj, NONE2A.fitadj), 
              c("full mediation", "partial mediation", "no mediation", "full mediation (nested)", "partial mediation (nested)", "no mediation (nested)"))

```


### Attendance2 ~ GDP.Millions2

__Attendance2 ~ GDP.Millions2__ is also mediated by __Total.Animals2 ~ GDP.Millions2__. Below we compare models with complete (full) mediation, partial mediation (i.e. model 20) and no mediation. Results from this output suggest that partial mediation (model 20) is the superior model.

```{r Mediation3 Att SEM Abund}

# Complete Mediation Model

FULL3A <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2
+ X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2'

FULL3A.fit <- sem(FULL3A, data = sem_attendance_data, fixed.x=FALSE)
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
FULL3A.fitadj <- lavaan.survey(lavaan.fit = FULL3A.fit, survey.design = design)

# Partial Mediation Model (MOdel 20)

PARTIAL3A.MOD20 <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2'

PARTIAL3A.MOD20.fit <- sem(PARTIAL3A.MOD20, data = sem_attendance_data, fixed.x=FALSE)
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
PARTIAL3A.MOD20.fitadj <- lavaan.survey(lavaan.fit = PARTIAL3A.MOD20.fit, survey.design = design)

# No Mediation Model

NONE3A <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2'

NONE3A.fit <- sem(NONE3A, data = sem_attendance_data, fixed.x=FALSE)
design <- svydesign(ids = ~Country, nest=TRUE, data=sem_attendance_data)
NONE3A.fitadj <- lavaan.survey(lavaan.fit = NONE3A.fit, survey.design = design)

aictab.lavaan(list(FULL3A.fit, PARTIAL3A.MOD20.fit, NONE3A.fit, 
                   FULL3A.fitadj, PARTIAL3A.MOD20.fitadj, NONE3A.fitadj), 
              c("full mediation", "partial mediation", "no mediation", "full mediation (nested)", "partial mediation (nested)", "no mediation (nested)"))

```


## Validation

Model validation is a process to rovide more evidence for the selected model (Fan _et al.,_ 2016), yet it is often overlooked or not reported in SEM studies. It is achieved by testing the model with two or more random datasets from the same sample to ensure paramater estimates are similar when a model is based on different datasets from the same population. Here we validate our model using four random subsets (n = 200 each time) of the existing dataset. 


## Validation Set 1

Parameter estimates relatively constant (some p-value differences).

```{r Valid1 Att SEM Abund}
# Chosen Attendance SEM (Abundance)
# Model 20

mod.20A.final <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2'

# Fit model and generate model summary
mod.20A.final.fit <- sem(mod.20A.final, data = validationset1, fixed.x=FALSE)
summary(mod.20A.final.fit, rsq = TRUE)

# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=validationset1)
fit.adj20A.final <- lavaan.survey(lavaan.fit = mod.20A.final.fit, survey.design = design) 
summary(fit.adj20A.final, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj20A.final, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

```

## Validation Set 2

Parameter estimates relatively constant (some p-value differences).

```{r Valid2 Att SEM Abund}
# Chosen Attendance SEM (Abundance)
# Model 20

mod.20A.final <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2'

# Fit model and generate model summary
mod.20A.final.fit <- sem(mod.20A.final, data = validationset2, fixed.x=FALSE)
summary(mod.20A.final.fit, rsq = TRUE)

# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=validationset2)
fit.adj20A.final <- lavaan.survey(lavaan.fit = mod.20A.final.fit, survey.design = design) 
summary(fit.adj20A.final, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj20A.final, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

```

## Validation Set 3

Parameter estimates relatively constant (some p-value differences).

```{r Valid3 Att SEM Abund}
# Chosen Attendance SEM (Abundance)
# Model 20

mod.20A.final <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2'

# Fit model and generate model summary
mod.20A.final.fit <- sem(mod.20A.final, data = validationset3, fixed.x=FALSE)
summary(mod.20A.final.fit, rsq = TRUE)

# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=validationset3)
fit.adj20A.final <- lavaan.survey(lavaan.fit = mod.20A.final.fit, survey.design = design) 
summary(fit.adj20A.final, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj20A.final, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

```

## Validation Set 4

Parameter estimates relatively constant (some p-value differences).

```{r Valid4 Att SEM Abund}
# Chosen Attendance SEM (Abundance)
# Model 20

mod.20A.final <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2
+ X10km_Pop2 + GDP.Millions2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + GDP.Millions2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2'

# Fit model and generate model summary
mod.20A.final.fit <- sem(mod.20A.final, data = validationset4, fixed.x=FALSE)
summary(mod.20A.final.fit, rsq = TRUE)

# Adjust for the nested nature of the data (institutions within countries)
# Fit model and generate model summary
design <- svydesign(ids = ~Country, nest=TRUE, data=validationset4)
fit.adj20A.final <- lavaan.survey(lavaan.fit = mod.20A.final.fit, survey.design = design) 
summary(fit.adj20A.final, rsq = TRUE) 

# Generate fit indices
fitMeasures(fit.adj20A.final, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

```
 

Across all the validation models while we see some differences regarding p-values, as would be expected we see qualitatively similar parameter estimates across the four validation sets.



# In Situ SEM 

Two distinct SEM frameworks were tested, the Attendance model and the In Situ model. The Attendance model tested the relationship between visitor attendance and all the various specified variables for 458 institutions globally. This model did not include any in situ contribution data. The In Situ model tested the relationship between visitor attendance, in situ contributions and all the various specified variables for a subset of 119 institutions in North America for which in situ contribution data was available. The results of the Attendance model were used to guide the development of the Attendance linked pathways in the In Situ model as the larger sample size of the Attendance model had higher power

Similar to the Attendance Model, two In Situ Models were developed, one based on species presence-absence per institution and the the other which also conisdered species' population sizes per institution. This was important for calculating mean species body mass per institution, the proportion of threatened species per institution etc. First we develop the model based on species presence-absence. 

# Species Presence - Absence
## Model 1 (a priori meta-model)

We now define our starting model for the SEM based on the a priori meta-model which is constructed based on evidence from the litrature and combined with proposed causal hypotheses. This model includes all previously identified evidence-based relationships and the numerous proposed causal pathways to visitor attendance. The development of this model can be found in the Supplementary information. Here we use the same proposed predictors of attendance for the in situ contributions. We use the species presence-absence Attendance Model to guide model development and identify relationships to visitor attendance, due to the larger sample size and therefore higher explanatory power in that model.  


```{r 1.1st In Situ SEM P-A}
# In Situ SEM (Presence-Absence)

# Model 1
# Based on a priori meta-model and results from the species presence-absence Attendance Model

mod.IS1 <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Sp2 + Prop.Threat.Sp2
+ Mean.Sp.BodyMass2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMass2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2

insitu2 ~ Attendance2 + Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Sp2 + Prop.Threat.Sp2
+ Mean.Sp.BodyMass2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2'

```

We then fit the model, generate the model summary and generate a selection of absolute fit indices (e.g. Standardized Root Mean Square Residual) and incremental fit indices (e.g. Comparative Fit Index), to account for the differential sensitivity of fit indices to data distribution, model size and sample size (Hu & Bentler, 1999). We then generate modification indices to identify suspected pathways for inclusion, with a standard cut-off level for the chi-square test criterion of 3.84 (Burnham and Anderson, 2002). As the in situ dataset contains only AZA institutions, there was no need to nest the data or include GDP in the model (institutions within countries).

```{r 1.2st In Situ SEM P-A}
# Fit model and generate model summary
mod.IS1.fit <- sem(mod.IS1, data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS1.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS1.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS1 <- modindices(mod.IS1.fit)
print(miIS1[miIS1$mi > 3.0,])

```


## Model 2 

None of the modification indices from the first model are conceptually appealling, so now we use p-values to identify potentially unsupported pathways, with a threshold of 0.05. Highest p-values are considered first for removal. Based on the results generated from the first model, the highest p-value relationship to be considered for removal is __insitu2 ~ Prop.Mam.Sp2__ with a p-value of __0.849__. As __Attendance2 ~ Prop.Mam.Sp2__ was unsupported in the previous models and has a p-value of __0.423__ here, we also remove __Attendance2 ~ Prop.Mam.Sp2__ here. Therefore we decide to remove these pathways. The model summary, fit indices and modification indices were all generated for the model.


```{r 2nd In Situ SEM P-A}
# In Situ SEM (Presence-Absence)

# Model 2
# Removal of insitu2 ~ Prop.Mam.Sp2, p = 0.849
# Removal of Attendance2 ~ Prop.Mam.Sp2, p = 0.423

mod.IS2 <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Threat.Sp2
+ Mean.Sp.BodyMass2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMass2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2

insitu2 ~ Attendance2 + Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Threat.Sp2
+ Mean.Sp.BodyMass2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2'

# Fit model and generate model summary
mod.IS2.fit <- sem(mod.IS2, data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS2.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS2.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS2 <- modindices(mod.IS2.fit)
print(miIS2[miIS2$mi > 3.0,])

```


## Model 3 

Based on the results generated from the second model, the highest p-value relationship to be considered for removal is __insitu2 ~ X50km_Pop2__ with a p-value of __0.818__. As __Attendance2 ~ X50km_Pop22__ was unsupported in the previous models, we also remove __Attendance2 ~ X50km_Pop22__ here. Therefore we decide to remove these pathways. The model summary, fit indices and modification indices were all generated for the model.


```{r 3rd In Situ SEM P-A}
# In Situ SEM (Presence-Absence)

# Model 3
# Removal of insitu2 ~ X50km_Pop2, p = 0.818
# Removal of Attendance2 ~ X50km_Pop22

mod.IS3 <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Threat.Sp2
+ Mean.Sp.BodyMass2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Sp.Richness2 + Total.Animals2 + Mean.Sp.BodyMass2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2

insitu2 ~ Attendance2 + Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Threat.Sp2
+ Mean.Sp.BodyMass2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X10km_Pop2'

# Fit model and generate model summary
mod.IS3.fit <- sem(mod.IS3, data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS3.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS3.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS3 <- modindices(mod.IS3.fit)
print(miIS3[miIS3$mi > 3.0,])

```


## Model 4

Based on the results generated from the third model, the highest p-value relationship to be considered for removal is __Mean.Raup.Crick2 ~ Sp.Richness2__ with a p-value of __0.801__. Therefore we decide to remove this pathway. Once again, the model summary, fit indices and modification indices were all generated for the model.


```{r 4th In Situ SEM P-A}
# In Situ SEM (Presence-Absence)

# Model 4
# Removal of Mean.Raup.Crick2 ~ Sp.Richness2, p = 0.801

mod.IS4 <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Threat.Sp2
+ Mean.Sp.BodyMass2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2

insitu2 ~ Attendance2 + Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Threat.Sp2
+ Mean.Sp.BodyMass2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X10km_Pop2'

# Fit model and generate model summary
mod.IS4.fit <- sem(mod.IS4, data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS4.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS4.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS4 <- modindices(mod.IS4.fit)
print(miIS4[miIS4$mi > 3.0,])

```


## Model 5

Based on the results generated from the fourth model, the highest p-value relationship to be considered for removal is __insitu2 ~ X10km_Pop2__ with a p-value of __0.794__. Therefore we decide to remove this pathway. Once again, the model summary, fit indices and modification indices were all generated for the model.


```{r 5th In Situ SEM P-A}
# In Situ SEM (Presence-Absence)

# Model 5
# Removal of insitu2 ~ X10km_Pop2, p = 0.794

mod.IS5 <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Threat.Sp2
+ Mean.Sp.BodyMass2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2

insitu2 ~ Attendance2 + Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Threat.Sp2
+ Mean.Sp.BodyMass2 + Brillouin.Index2 + Mean.Raup.Crick2'

# Fit model and generate model summary
mod.IS5.fit <- sem(mod.IS5, data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS5.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS5.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS5 <- modindices(mod.IS5.fit)
print(miIS5[miIS5$mi > 3.0,])

```

 
## Model 6

Based on the results generated from the fifth model, the highest p-value relationship to be considered for removal is __Attendance2 ~ Zoo.Area.ha2__ with a p-value of __0.694__. Therefore we decide to remove this pathway. Once again, the model summary, fit indices and modification indices were all generated for the model.


```{r 6th In Situ SEM P-A}
# In Situ SEM (Presence-Absence)

# Model 6
# Removal of Attendance2 ~ Zoo.Area.ha2, p = 0.694

mod.IS6 <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Threat.Sp2
+ Mean.Sp.BodyMass2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2

insitu2 ~ Attendance2 + Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Threat.Sp2
+ Mean.Sp.BodyMass2 + Brillouin.Index2 + Mean.Raup.Crick2'

# Fit model and generate model summary
mod.IS6.fit <- sem(mod.IS6, data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS6.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS6.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS6 <- modindices(mod.IS6.fit)
print(miIS6[miIS6$mi > 3.0,])

```


## Model 7

Based on the results generated from the sixth model, the highest p-value relationship to be considered for removal is __insitu2 ~ Men.Sp.BdyMss2__ with a p-value of __0.351__. Therefore we decide to remove this pathway. Once again, the model summary, fit indices and modification indices were all generated for the model.


```{r 7th In Situ SEM P-A}
# In Situ SEM (Presence-Absence)

# Model 7
# Removal of insitu2 ~ Men.Sp.BdyMss2, p = 0.351

mod.IS7 <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Threat.Sp2
+ Mean.Sp.BodyMass2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2

insitu2 ~ Attendance2 + Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Threat.Sp2
+ Brillouin.Index2 + Mean.Raup.Crick2'

# Fit model and generate model summary
mod.IS7.fit <- sem(mod.IS7, data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS7.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS7.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS7 <- modindices(mod.IS7.fit)
print(miIS7[miIS7$mi > 3.0,])

```


## Model 8

Based on the results generated from the seventh model, the highest p-value relationship to be considered for removal is __Attendance2 ~ Mam.Sp.Rchnss2__ with a p-value of __0.299__. Therefore we decide to remove this pathway. Once again, the model summary, fit indices and modification indices were all generated for the model.


```{r 8th In Situ SEM P-A}
# In Situ SEM (Presence-Absence)

# Model 8
# Removal of Attendance2 ~ Mam.Sp.Rchnss2, p = 0.299

mod.IS8 <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Prop.Threat.Sp2 + Mean.Sp.BodyMass2 + Brillouin.Index2 
+ Mean.Raup.Crick2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2

insitu2 ~ Attendance2 + Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Threat.Sp2
+ Brillouin.Index2 + Mean.Raup.Crick2'

# Fit model and generate model summary
mod.IS8.fit <- sem(mod.IS8, data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS8.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS8.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS8 <- modindices(mod.IS8.fit)
print(miIS8[miIS8$mi > 3.0,])

```


## Model 9

Based on the results generated from the eight model, the highest p-value relationship to be considered for removal is __insitu2 ~ Sp.Richness2__ with a p-value of __0.297__. Therefore we decide to remove this pathway. Once again, the model summary, fit indices and modification indices were all generated for the model.


```{r 9th In Situ SEM P-A}
# In Situ SEM (Presence-Absence)

# Model 9
# Removal of insitu2 ~ Sp.Richness2, p = 0.297

mod.IS9 <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Prop.Threat.Sp2 + Mean.Sp.BodyMass2 + Brillouin.Index2 
+ Mean.Raup.Crick2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2

insitu2 ~ Attendance2 + Zoo.Area.ha2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Threat.Sp2
+ Brillouin.Index2 + Mean.Raup.Crick2'

# Fit model and generate model summary
mod.IS9.fit <- sem(mod.IS9, data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS9.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS9.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS9 <- modindices(mod.IS9.fit)
print(miIS9[miIS9$mi > 3.0,])

```



## Model 10

Based on the results generated from the ninth model, the highest p-value relationship to be considered for removal is __insitu2 ~ Brilloun.Indx2__ with a p-value of __0.593__. Therefore we decide to remove this pathway. Once again, the model summary, fit indices and modification indices were all generated for the model.


```{r 10th In Situ SEM P-A}
# In Situ SEM (Presence-Absence)

# Model 10
# Removal of insitu2 ~ Brilloun.Indx2, p = 0.593

mod.IS10 <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Prop.Threat.Sp2 + Mean.Sp.BodyMass2 + Brillouin.Index2 
+ Mean.Raup.Crick2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2

insitu2 ~ Attendance2 + Zoo.Area.ha2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Threat.Sp2
+ Mean.Raup.Crick2'

# Fit model and generate model summary
mod.IS10.fit <- sem(mod.IS10, data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS10.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS10.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS10 <- modindices(mod.IS10.fit)
print(miIS10[miIS10$mi > 3.0,])

```


## Model 11

Based on the results generated from the tenth model, the highest p-value relationship to be considered for removal is __Attendance2 ~ Prop.Thret.Sp2__ with a p-value of __0.141__. Therefore we decide to remove this pathway. Once again, the model summary, fit indices and modification indices were all generated for the model.


```{r 11th In Situ SEM P-A}
# In Situ SEM (Presence-Absence)

# Model 11
# Removal of Attendance2 ~ Prop.Thret.Sp2, p = 0.141

mod.IS11 <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mean.Sp.BodyMass2 + Brillouin.Index2 
+ Mean.Raup.Crick2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2

insitu2 ~ Attendance2 + Zoo.Area.ha2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Threat.Sp2
+ Mean.Raup.Crick2'

# Fit model and generate model summary
mod.IS11.fit <- sem(mod.IS11, data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS11.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS11.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS11 <- modindices(mod.IS11.fit)
print(miIS11[miIS11$mi > 3.0,])

```


## Model 12

Based on the results generated from the eleventh model, the highest p-value relationship to be considered for removal is __insitu2 ~ Mam.Sp.Rchnss2__ with a p-value of __0.095__. Therefore we decide to remove this pathway. Once again, the model summary, fit indices and modification indices were all generated for the model.


```{r 12th In Situ SEM P-A}
# In Situ SEM (Presence-Absence)

# Model 12
# Removal of insitu2 ~ Mam.Sp.Rchnss2, p = 0.095

mod.IS12 <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mean.Sp.BodyMass2 + Brillouin.Index2 
+ Mean.Raup.Crick2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2

insitu2 ~ Attendance2 + Zoo.Area.ha2 + Total.Animals2
+ Prop.Threat.Sp2 + Mean.Raup.Crick2'

# Fit model and generate model summary
mod.IS12.fit <- sem(mod.IS12, data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS12.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS12.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS12 <- modindices(mod.IS12.fit)
print(miIS12[miIS12$mi > 3.0,])

```



## Model 13

Based on the results generated from the twelfth model, the highest p-value relationship to be considered for removal is __insitu2 ~ Total.Animals2__ with a p-value of __0.255__. Therefore we decide to remove this pathway. Once again, the model summary, fit indices and modification indices were all generated for the model.


```{r 13th In Situ SEM P-A}
# In Situ SEM (Presence-Absence)

# Model 13
# Removal of insitu2 ~ Total.Animals2, p = 0.255

mod.IS13 <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mean.Sp.BodyMass2 + Brillouin.Index2 
+ Mean.Raup.Crick2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2

insitu2 ~ Attendance2 + Zoo.Area.ha2 
+ Prop.Threat.Sp2 + Mean.Raup.Crick2'

# Fit model and generate model summary
mod.IS13.fit <- sem(mod.IS13, data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS13.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS13.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS13 <- modindices(mod.IS13.fit)
print(miIS13[miIS13$mi > 3.0,])

```


## Model Comparisons

At this stage we compare the models generated using AICc values. Overall model selection from the pool of competing models is achieved using AICc values, with a threshold of more than 2 AICc units lower than nearest competing model being considered sufficient for model selection. 

```{r 1st AICc In Situ SEM P-A}
# Model Comparisons using AICc

# Comparing models with and without adjustment for nested nature of data
# library(AICcmodavg) 
# source("lavaan.modavg.R")

aictab.lavaan(list(mod.IS1.fit, mod.IS2.fit, mod.IS3.fit, mod.IS4.fit, mod.IS5.fit, mod.IS6.fit, 
                   mod.IS7.fit, mod.IS8.fit, mod.IS9.fit, mod.IS10.fit, mod.IS11.fit, mod.IS12.fit, mod.IS13.fit), 
              c("mod.1", "mod.2", "mod.3", "mod.4", "mod.5", "mod.6", "mod.7", "mod.8", 
                "mod.9", "mod.10", "mod.11", "mod.12", "mod.13"))

```

Based on these results we can see that model 13 is the superior model (lowest AICc value).


## Model 14

Due to the fact that __Brillouin.Index2__ was deemed unnecessary in the Attendance Model and has proven unnecessary for the In Situ portion of this model, we choose to remove this variable entirely once again. The model summary, fit indices and modification indices were all generated for the model.


```{r 14th In Situ SEM P-A}
# In Situ SEM (Presence-Absence)

# Model 14
# Removal of Brillouin.Index2

mod.IS14 <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2

insitu2 ~ Attendance2 + Zoo.Area.ha2 
+ Prop.Threat.Sp2 + Mean.Raup.Crick2'

# Fit model and generate model summary
mod.IS14.fit <- sem(mod.IS14, data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS14.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS14.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS14 <- modindices(mod.IS14.fit)
print(miIS14[miIS14$mi > 3.0,])

```


## Model Comparisons

Once again we compare the models generated using AICc values in order to ensure the removal of the __Brillouin.Index2__ was statistically justified. Overall model selection from the pool of competing models is achieved using AICc values, with a threshold of more than 2 AICc units lower than nearest competing model being considered sufficient for model selection. 

```{r 2nd, AICc In Situ SEM P-A}
# Model Comparisons using AICc

# Comparing models with and without adjustment for nested nature of data
# library(AICcmodavg) 
# source("lavaan.modavg.R")

aictab.lavaan(list(mod.IS1.fit, mod.IS2.fit, mod.IS3.fit, mod.IS4.fit, mod.IS5.fit, mod.IS6.fit, 
                   mod.IS7.fit, mod.IS8.fit, mod.IS9.fit, mod.IS10.fit, mod.IS11.fit, mod.IS12.fit, mod.IS13.fit, mod.IS14.fit), 
              c("mod.1", "mod.2", "mod.3", "mod.4", "mod.5", "mod.6", "mod.7", "mod.8", 
                "mod.9", "mod.10", "mod.11", "mod.12", "mod.13", "mod.14"))

```

Based on these results we can see that model 14 is the superior model (lowest AICc value) and that __Brillouin.Index2__ was not supported.


## Model 15

Based on the results generated from the fourteenth model, the highest p-value relationship to be considered for removal is __Attendance2 ~ Sp.Richness2__ with a p-value of __0.853__. Therefore we decide to remove this pathway. Once again, the model summary, fit indices and modification indices were all generated for the model.


```{r 15th In Situ SEM P-A}
# In Situ SEM (Presence-Absence)

# Model 15
# Removal of Attendance2 ~ Sp.Richness2, p = 0.853

mod.IS15 <- 'Attendance2 ~ Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2

insitu2 ~ Attendance2 + Zoo.Area.ha2 
+ Prop.Threat.Sp2 + Mean.Raup.Crick2'

# Fit model and generate model summary
mod.IS15.fit <- sem(mod.IS15, data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS15.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS15.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS15 <- modindices(mod.IS15.fit)
print(miIS15[miIS15$mi > 3.0,])

```


## Model 16

Based on the modification indices generated from the fifteenth model, we can see that __Mean.Raup.Crick2 ~ Prop.Threat.Sp2__ has one of the highest mi value of __13.894__. This far exceeds the standard cut-off level for the chi-square test criterion of 3.84 (Burnham and Anderson, 2002). This is also an intuitive relationships, as threatened species by their very nature are not common, therefore an institution with a greater proportion of threatened species will be statistically more likely to be dissimilar to other collections. As a result, we add this relationship to our model. Once again, the model summary, fit indices and modification indices were all generated for the model. 


```{r 16th In Situ SEM P-A}
# In Situ SEM (Presence-Absence)

# Model 16
# Addition of Mean.Raup.Crick2 ~ Prop.Threat.Sp2, mi = 13.894

mod.IS16 <- 'Attendance2 ~ Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2 + Prop.Threat.Sp2

insitu2 ~ Attendance2 + Zoo.Area.ha2 
+ Prop.Threat.Sp2 + Mean.Raup.Crick2'

# Fit model and generate model summary
mod.IS16.fit <- sem(mod.IS16, data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS16.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS16.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS16 <- modindices(mod.IS16.fit)
print(miIS16[miIS16$mi > 3.0,])

```


## Model 17

Based on the results generated from the fourteenth model, the highest p-value relationship to be considered for removal is __insitu2 ~ Mean.Rap.Crck2__ with a p-value of __0.053__. Therefore we decide to remove this pathway. Once again, the model summary, fit indices and modification indices were all generated for the model.



```{r 17th In Situ SEM P-A}
# In Situ SEM (Presence-Absence)

# Model 17
# Removal of insitu2 ~ Mean.Rap.Crck2, p = 0.053

mod.IS17 <- 'Attendance2 ~ Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2 + Prop.Threat.Sp2

insitu2 ~ Attendance2 + Zoo.Area.ha2 
+ Prop.Threat.Sp2'

# Fit model and generate model summary
mod.IS17.fit <- sem(mod.IS17, data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS17.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS17.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS17 <- modindices(mod.IS17.fit)
print(miIS17[miIS17$mi > 3.0,])

```


# Model Comparisons

Once again we compare the models generated using AICc values. Overall model selection from the pool of competing models is achieved using AICc values, with a threshold of more than 2 AICc units lower than nearest competing model being considered sufficient for model selection. 

```{r 3rd, AICc In Situ SEM P-A}
# Model Comparisons using AICc

# Comparing models with and without adjustment for nested nature of data
# library(AICcmodavg) 
# source("lavaan.modavg.R")

aictab.lavaan(list(mod.IS1.fit, mod.IS2.fit, mod.IS3.fit, mod.IS4.fit, mod.IS5.fit, mod.IS6.fit, 
                   mod.IS7.fit, mod.IS8.fit, mod.IS9.fit, mod.IS10.fit, mod.IS11.fit, mod.IS12.fit, mod.IS13.fit, mod.IS14.fit, mod.IS15.fit, mod.IS16.fit, mod.IS17.fit), 
              c("mod.1", "mod.2", "mod.3", "mod.4", "mod.5", "mod.6", "mod.7", "mod.8", 
                "mod.9", "mod.10", "mod.11", "mod.12", "mod.13", "mod.14", "mod.15", "mod.16", "mod.17"))

```

Based on these results we can see that model 17 is the superior model (lowest AICc value), as the addition of __insitu2 ~ Mean.Rap.Crck2__ does not lower the AIC value by more than 2 units. 


# Final In Situ Model (Species Presence - Absence)

Based on the results, we believe model 17 is an accurate representation of the system. No further addition seems conceptually appealling or statistically justified. In addition all pathways appear significant. Therefore we present model 17 as our final In Situ Model based on species presence-absence data. 

```{r Final In Situ SEM P-A}
# Chosen In Situ SEM (Presence-Absence)
# Model 17

mod.ISPAFinal <- 'Attendance2 ~ Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2 + Prop.Threat.Sp2

insitu2 ~ Attendance2 + Zoo.Area.ha2
+ Prop.Threat.Sp2'

# Fit model and generate model summary
mod.ISPAFinal.fit <- sem(mod.ISPAFinal, data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.ISPAFinal.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.ISPAFinal.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miISPAFinal <- modindices(mod.ISPAFinal.fit)
print(miISPAFinal[miISPAFinal$mi > 3.0,])

```


## Tests of Mediation 


It is clear from Model 17 that several pathways are mediated in the system. It is necessary to evaluate whether this mediation is appropriate by comparing models with complete, partial and no mediation. Here we show tests of mediation for three of these relationships. 

### insitu2 ~ Mean.Sp.BodyMass2

__insitu2 ~ Mean.Sp.BodyMass2__ is completely mediated by __Attendance2 ~ Mean.Sp.BodyMass2__. Below we compare models with complete (full, i.e. Model 17) mediation, partial mediation and no mediation. Results from this output suggest that complete mediation (model 17) is the superior model.

```{r Mediation1 In Situ SEM P-A}

# Complete Mediation Model (Model 17)

FULL1A.MOD17 <- 'Attendance2 ~ Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2 + Prop.Threat.Sp2

insitu2 ~ Attendance2 + Zoo.Area.ha2
+ Prop.Threat.Sp2'

FULL1A.MOD17.fit <- sem(FULL1A.MOD17, data = sem_in_situ_data, fixed.x=FALSE)

# Partial Mediation Model

PARTIAL1A <- 'Attendance2 ~ Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2 + Prop.Threat.Sp2

insitu2 ~ Attendance2 + Zoo.Area.ha2
+ Prop.Threat.Sp2 + Mean.Sp.BodyMass2'

PARTIAL1A.fit <- sem(PARTIAL1A, data = sem_in_situ_data, fixed.x=FALSE)

# No Mediation Model

NONE1A <- 'Attendance2 ~ Total.Animals2
+ Mean.Raup.Crick2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2 + Prop.Threat.Sp2

insitu2 ~ Attendance2 + Zoo.Area.ha2
+ Prop.Threat.Sp2 + Mean.Sp.BodyMass2'

NONE1A.fit <- sem(NONE1A, data = sem_in_situ_data, fixed.x=FALSE)

aictab.lavaan(list(FULL1A.MOD17.fit, PARTIAL1A.fit, NONE1A.fit), 
              c("full mediation", "partial mediation", "no mediation"))

```


### insitu2 ~ Prop.Threat.Sp2

__insitu2 ~ Prop.Threat.Sp2__ is not mediated. Therefore we want to test if partial mediation is appropriate by including by __Attendance2 ~ Prop.Threat.Sp2__. Below we compare models with complete (full) mediation, partial mediation and no mediation (Model 17). Results from this output suggest that no mediation (model 17) is the superior model.

```{r Mediation2 In Situ SEM P-A}

# Complete Mediation Model

FULL2A <- 'Attendance2 ~ Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2 + X10km_Pop2 + Prop.Threat.Sp2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2 + Prop.Threat.Sp2

insitu2 ~ Attendance2 + Zoo.Area.ha2'

FULL2A.fit <- sem(FULL2A, data = sem_in_situ_data, fixed.x=FALSE)

# Partial Mediation Model

PARTIAL2A <- 'Attendance2 ~ Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2 + X10km_Pop2 + Prop.Threat.Sp2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2 + Prop.Threat.Sp2

insitu2 ~ Attendance2 + Zoo.Area.ha2
+ Prop.Threat.Sp2'

PARTIAL2A.fit <- sem(PARTIAL2A, data = sem_in_situ_data, fixed.x=FALSE)

# No Mediation Model (Model 17)

NONE2A.MOD17 <- 'Attendance2 ~ Total.Animals2
+ Mean.Sp.BodyMass2 + Mean.Raup.Crick2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMass2
Mean.Raup.Crick2 ~ Total.Animals2 + Mean.Sp.BodyMass2 + Prop.Threat.Sp2

insitu2 ~ Attendance2 + Zoo.Area.ha2
+ Prop.Threat.Sp2'

NONE2A.MOD17.fit <- sem(NONE2A.MOD17, data = sem_in_situ_data, fixed.x=FALSE)

aictab.lavaan(list(FULL2A.fit, PARTIAL2A.fit, NONE2A.MOD17.fit), 
              c("full mediation", "partial mediation", "no mediation"))

```


Similar to the Attendance Model, two In Situ Models were developed, one based on species presence-absence per institution and the the other which also conisdered species' population sizes per institution. This was important for calculating mean species body mass per institution, the proportion of threatened species per institution etc. Here we develop the model based on species abundance.

# Species Abundance
## Model 1 (a priori meta-model)

We now define our starting model for the SEM based on the a priori meta-model which is constructed based on evidence from the litrature and combined with proposed causal hypotheses. This model includes all previously identified evidence-based relationships and the numerous proposed causal pathways to visitor attendance. The development of this model can be found in the Supplementary information. Here we use the same proposed predictors of attendance for the in situ contributions. We use the species abundance Attendance Model to guide model development and identify relationships to visitor attendance, due to the larger sample size and therefore higher explanatory power in that model. 


```{r 1.1st In Situ SEM Abund}
# In Situ SEM (Abundance)

# Model 1
# Based on a priori meta-model and results from the species abundance Attendance Model

mod.IS1A <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Abdun2 + Prop.Threat.Abund2
+ Mean.Sp.BodyMassXAbund2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2

insitu2 ~ Attendance2 + Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Abdun2 + Prop.Threat.Abund2
+ Mean.Sp.BodyMassXAbund2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2'

```

We then fit the model, generate the model summary and generate a selection of absolute fit indices (e.g. Standardized Root Mean Square Residual) and incremental fit indices (e.g. Comparative Fit Index), to account for the differential sensitivity of fit indices to data distribution, model size and sample size (Hu & Bentler, 1999). We then generate modification indices to identify suspected pathways for inclusion, with a standard cut-off level for the chi-square test criterion of 3.84 (Burnham and Anderson, 2002). As the in situ dataset contains only AZA institutions, there was no need to nest the data or include GDP in the model (institutions within countries).

```{r 1.2st In Situ SEM Abund}
# Fit model and generate model summary
mod.IS1A.fit <- sem(mod.IS1A , data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS1A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS1A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS1A <- modindices(mod.IS1A.fit)
print(miIS1A[miIS1A$mi > 3.0,])

```


## Model 2 

None of the modification indices from the first model are conceptually appealling, so now we use p-values to identify potentially unsupported pathways, with a threshold of 0.05. Highest p-values are considered first for removal. Based on the results generated from the first model, the highest p-value relationship to be considered for removal is __Sp.Richness2 ~ Zoo.Area.ha2__ with a p-value of __0.848__. Therefore we decide to remove this pathway. The model summary, fit indices and modification indices were all generated for the model.


```{r 2nd In Situ SEM Abund}
# In Situ SEM (Abundance)

# Model 2
# Removal of Sp.Richness2 ~ Zoo.Area.ha2, p = 0.848

mod.IS2A <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Abdun2 + Prop.Threat.Abund2
+ Mean.Sp.BodyMassXAbund2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2

insitu2 ~ Attendance2 + Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Abdun2 + Prop.Threat.Abund2
+ Mean.Sp.BodyMassXAbund2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2'

# Fit model and generate model summary
mod.IS2A.fit <- sem(mod.IS2A , data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS2A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS2A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS2A <- modindices(mod.IS2A.fit)
print(miIS2A[miIS2A$mi > 3.0,])

```


## Model 3

Based on the results generated from the second model, the highest p-value relationship to be considered for removal is __insitu2 ~ X10km_Pop2__ with a p-value of __0.836__. Therefore we decide to remove this pathway. The model summary, fit indices and modification indices were all generated for the model.


```{r 3rd In Situ SEM Abund}
# In Situ SEM (Abundance)

# Model 3
# Removal of insitu2 ~ X10km_Pop2, p = 0.836

mod.IS3A <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Abdun2 + Prop.Threat.Abund2
+ Mean.Sp.BodyMassXAbund2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X50km_Pop2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2

insitu2 ~ Attendance2 + Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Abdun2 + Prop.Threat.Abund2
+ Mean.Sp.BodyMassXAbund2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X50km_Pop2'

# Fit model and generate model summary
mod.IS3A.fit <- sem(mod.IS3A , data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS3A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS3A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS3A <- modindices(mod.IS3A.fit)
print(miIS3A[miIS3A$mi > 3.0,])

```



## Model 4

Based on the results generated from the third model, the highest p-value relationship to be considered for removal is __insitu2 ~ X50km_Pop2__ with a p-value of __0.887__. As __Attendance2 ~ X50km_Pop22__ was unsupported in the previous models, we also remove __Attendance2 ~ X50km_Pop22__ here. Therefore we decide to remove these pathways. The model summary, fit indices and modification indices were all generated for the model.


```{r 4th In Situ SEM Abund}
# In Situ SEM (Abundance)

# Model 4
# Removal of insitu2 ~ X50km_Pop2, p = 0.887
# Removal of Attendance2 ~ X50km_Pop22

mod.IS4A <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Abdun2 + Prop.Threat.Abund2
+ Mean.Sp.BodyMassXAbund2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2

insitu2 ~ Attendance2 + Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Abdun2 + Prop.Threat.Abund2
+ Mean.Sp.BodyMassXAbund2 + Brillouin.Index2 + Mean.Raup.Crick2'

# Fit model and generate model summary
mod.IS4A.fit <- sem(mod.IS4A , data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS4A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS4A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS4A <- modindices(mod.IS4A.fit)
print(miIS4A[miIS4A$mi > 3.0,])

```


## Model 5

Based on the results generated from the fourth model, the highest p-value relationship to be considered for removal is __Attendance2 ~ Prop.Mam.Abdn2__ with a p-value of __0.695__. Therefore we decide to remove this pathway. The model summary, fit indices and modification indices were all generated for the model.


```{r 5th In Situ SEM Abund}
# In Situ SEM (Abundance)

# Model 5
# Removal of Attendance2 ~ Prop.Mam.Abdn2, p = 0.695

mod.IS5A <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Threat.Abund2
+ Mean.Sp.BodyMassXAbund2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2

insitu2 ~ Attendance2 + Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Abdun2 + Prop.Threat.Abund2
+ Mean.Sp.BodyMassXAbund2 + Brillouin.Index2 + Mean.Raup.Crick2'

# Fit model and generate model summary
mod.IS5A.fit <- sem(mod.IS5A , data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS5A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS5A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS5A <- modindices(mod.IS5A.fit)
print(miIS5A[miIS5A$mi > 3.0,])

```


## Model 6

Based on the results generated from the fifth model, the highest p-value relationship to be considered for removal is __insitu2 ~ Mn.Sp.BdyMsXA2__ with a p-value of __0.687__. Therefore we decide to remove this pathway. The model summary, fit indices and modification indices were all generated for the model.


```{r 6th In Situ SEM Abund}
# In Situ SEM (Abundance)

# Model 6
# Removal of insitu2 ~ Mn.Sp.BdyMsXA2, p = 0.687

mod.IS6A <- 'Attendance2 ~ Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Threat.Abund2
+ Mean.Sp.BodyMassXAbund2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2

insitu2 ~ Attendance2 + Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Abdun2 + Prop.Threat.Abund2
+ Brillouin.Index2 + Mean.Raup.Crick2'

# Fit model and generate model summary
mod.IS6A.fit <- sem(mod.IS6A , data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS6A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS6A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS6A <- modindices(mod.IS6A.fit)
print(miIS6A[miIS6A$mi > 3.0,])

```


## Model 7

Based on the results generated from the sixth model, the highest p-value relationship to be considered for removal is __Attendance2 ~ Zoo.Area.ha2__ with a p-value of __0.664__. Therefore we decide to remove this pathway. The model summary, fit indices and modification indices were all generated for the model.


```{r 7th In Situ SEM Abund}
# In Situ SEM (Abundance)

# Model 7
# Removal of Attendance2 ~ Zoo.Area.ha2, p = 0.664

mod.IS7A <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Threat.Abund2
+ Mean.Sp.BodyMassXAbund2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2

insitu2 ~ Attendance2 + Zoo.Area.ha2 + Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Abdun2 + Prop.Threat.Abund2
+ Brillouin.Index2 + Mean.Raup.Crick2'

# Fit model and generate model summary
mod.IS7A.fit <- sem(mod.IS7A , data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS7A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS7A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS7A <- modindices(mod.IS7A.fit)
print(miIS7A[miIS7A$mi > 3.0,])

```


## Model 8

Based on the results generated from the seventh model, the highest p-value relationship to be considered for removal is __insitu2 ~ Sp.Richness2__ with a p-value of __0.442__. Therefore we decide to remove this pathway. The model summary, fit indices and modification indices were all generated for the model.


```{r 8th In Situ SEM Abund}
# In Situ SEM (Abundance)

# Model 8
# Removal of insitu2 ~ Sp.Richness2, p = 0.442

mod.IS8A <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Threat.Abund2
+ Mean.Sp.BodyMassXAbund2 + Brillouin.Index2 + Mean.Raup.Crick2
+ X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2

insitu2 ~ Attendance2 + Zoo.Area.ha2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Abdun2 + Prop.Threat.Abund2
+ Brillouin.Index2 + Mean.Raup.Crick2'

# Fit model and generate model summary
mod.IS8A.fit <- sem(mod.IS8A , data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS8A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS8A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS8A <- modindices(mod.IS8A.fit)
print(miIS8A[miIS8A$mi > 3.0,])

```


## Model 9

Based on the results generated from the eight model, the highest p-value relationship to be considered for removal is __Attendance2 ~ Mam.Sp.Rchnss2__ with a p-value of __0.351__. Therefore we decide to remove this pathway. The model summary, fit indices and modification indices were all generated for the model.


```{r 9th In Situ SEM Abund}
# In Situ SEM (Abundance)

# Model 9
# Removal of Attendance2 ~ Mam.Sp.Rchnss2, p = 0.351

mod.IS9A <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Prop.Threat.Abund2 + Mean.Sp.BodyMassXAbund2 + Brillouin.Index2 
+ Mean.Raup.Crick2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2

insitu2 ~ Attendance2 + Zoo.Area.ha2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Mam.Abdun2 + Prop.Threat.Abund2
+ Brillouin.Index2 + Mean.Raup.Crick2'

# Fit model and generate model summary
mod.IS9A.fit <- sem(mod.IS9A , data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS9A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS9A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS9A <- modindices(mod.IS9A.fit)
print(miIS9A[miIS9A$mi > 3.0,])

```


## Model 10

Based on the results generated from the ninth model, the highest p-value relationship to be considered for removal is __insitu2 ~ Prop.Mam.Abdn2__ with a p-value of __0.237__. Therefore we decide to remove this pathway. The model summary, fit indices and modification indices were all generated for the model.


```{r 10th In Situ SEM Abund}
# In Situ SEM (Abundance)

# Model 10
# Removal of insitu2 ~ Prop.Mam.Abdn2, p = 0.237

mod.IS10A <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Prop.Threat.Abund2 + Mean.Sp.BodyMassXAbund2 + Brillouin.Index2 
+ Mean.Raup.Crick2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2

insitu2 ~ Attendance2 + Zoo.Area.ha2 + Total.Animals2
+ Mam.Sp.Richness2 + Prop.Threat.Abund2
+ Brillouin.Index2 + Mean.Raup.Crick2'

# Fit model and generate model summary
mod.IS10A.fit <- sem(mod.IS10A , data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS10A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS10A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS10A <- modindices(mod.IS10A.fit)
print(miIS10A[miIS10A$mi > 3.0,])

```


## Model 11

Based on the results generated from the tenth model, the highest p-value relationship to be considered for removal is __insitu2 ~ Total.Animals2__ with a p-value of __0.192__. Therefore we decide to remove this pathway. The model summary, fit indices and modification indices were all generated for the model.


```{r 11th In Situ SEM Abund}
# In Situ SEM (Abundance)

# Model 11
# Removal of insitu2 ~ Total.Animals2, p = 0.192

mod.IS11A <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Prop.Threat.Abund2 + Mean.Sp.BodyMassXAbund2 + Brillouin.Index2 
+ Mean.Raup.Crick2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2

insitu2 ~ Attendance2 + Zoo.Area.ha2
+ Mam.Sp.Richness2 + Prop.Threat.Abund2
+ Brillouin.Index2 + Mean.Raup.Crick2'

# Fit model and generate model summary
mod.IS11A.fit <- sem(mod.IS11A , data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS11A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS11A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS11A <- modindices(mod.IS11A.fit)
print(miIS11A[miIS11A$mi > 3.0,])

```


## Model 12

Based on the results generated from the eleventh model, the highest p-value relationship to be considered for removal is __insitu2 ~ Mam.Sp.Rchnss2__ with a p-value of __0.223__. Therefore we decide to remove this pathway. The model summary, fit indices and modification indices were all generated for the model.


```{r 12th In Situ SEM Abund}
# In Situ SEM (Abundance)

# Model 12
# Removal of insitu2 ~ Mam.Sp.Rchnss2, p = 0.223

mod.IS12A <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Prop.Threat.Abund2 + Mean.Sp.BodyMassXAbund2 + Brillouin.Index2 
+ Mean.Raup.Crick2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2

insitu2 ~ Attendance2 + Zoo.Area.ha2
+ Prop.Threat.Abund2
+ Brillouin.Index2 + Mean.Raup.Crick2'

# Fit model and generate model summary
mod.IS12A.fit <- sem(mod.IS12A , data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS12A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS12A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS12A <- modindices(mod.IS12A.fit)
print(miIS12A[miIS12A$mi > 3.0,])

```


## Model 13

Based on the results generated from the twelfth model, the highest p-value relationship to be considered for removal is __insitu2 ~ Brilloun.Indx2__ with a p-value of __0.327__. Therefore we decide to remove this pathway. The model summary, fit indices and modification indices were all generated for the model.


```{r 13th In Situ SEM Abund}
# In Situ SEM (Abundance)

# Model 13
# Removal of insitu2 ~ Brilloun.Indx2, p = 0.327

mod.IS13A <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Prop.Threat.Abund2 + Mean.Sp.BodyMassXAbund2 + Brillouin.Index2 
+ Mean.Raup.Crick2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2

insitu2 ~ Attendance2 + Zoo.Area.ha2
+ Prop.Threat.Abund2 + Mean.Raup.Crick2'

# Fit model and generate model summary
mod.IS13A.fit <- sem(mod.IS13A , data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS13A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS13A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS13A <- modindices(mod.IS13A.fit)
print(miIS13A[miIS13A$mi > 3.0,])

```


## Model 14

Based on the results generated from the thirteenth model, the highest p-value relationship to be considered for removal is __insitu2 ~ Mean.Rap.Crck2__ with a p-value of __0.162__. Therefore we decide to remove this pathway. The model summary, fit indices and modification indices were all generated for the model.


```{r 14th In Situ SEM Abund}
# In Situ SEM (Abundance)

# Model 14
# Removal of insitu2 ~ Mean.Rap.Crck2, p = 0.162

mod.IS14A <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Prop.Threat.Abund2 + Mean.Sp.BodyMassXAbund2 + Brillouin.Index2 
+ Mean.Raup.Crick2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2

insitu2 ~ Attendance2 + Zoo.Area.ha2
+ Prop.Threat.Abund2'

# Fit model and generate model summary
mod.IS14A.fit <- sem(mod.IS14A , data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS14A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS14A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS14A <- modindices(mod.IS14A.fit)
print(miIS14A[miIS14A$mi > 3.0,])

```


## Model 15

Based on the results generated from the fourteenth model, the highest p-value relationship to be considered for removal is __Attendance2 ~ Prp.Thrt.Abnd2__ with a p-value of __0.121__. Therefore we decide to remove this pathway. The model summary, fit indices and modification indices were all generated for the model.


```{r 15th In Situ SEM Abund}
# In Situ SEM (Abundance)

# Model 15
# Removal of Attendance2 ~ Prp.Thrt.Abnd2, p = 0.121

mod.IS15A <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mean.Sp.BodyMassXAbund2 + Brillouin.Index2 
+ Mean.Raup.Crick2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2
Brillouin.Index2 ~ Sp.Richness2 + Total.Animals2

insitu2 ~ Attendance2 + Zoo.Area.ha2
+ Prop.Threat.Abund2'

# Fit model and generate model summary
mod.IS15A.fit <- sem(mod.IS15A , data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS15A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS15A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS15A <- modindices(mod.IS15A.fit)
print(miIS15A[miIS15A$mi > 3.0,])

```


# Model Comparisons

Once again we compare the models generated using AICc values. Overall model selection from the pool of competing models is achieved using AICc values, with a threshold of more than 2 AICc units lower than nearest competing model being considered sufficient for model selection. 

```{r 1st, AICc In Situ SEM Abund}
# Model Comparisons using AICc

# Comparing models with and without adjustment for nested nature of data
# library(AICcmodavg) 
# source("lavaan.modavg.R")

aictab.lavaan(list(mod.IS1A.fit, mod.IS2A.fit, mod.IS3A.fit, mod.IS4A.fit, mod.IS5A.fit, 
                   mod.IS6A.fit, mod.IS7A.fit, mod.IS8A.fit, mod.IS9A.fit, mod.IS10A.fit,
                   mod.IS11A.fit, mod.IS12A.fit, mod.IS13A.fit, mod.IS14A.fit, mod.IS15A.fit), 
              c("mod.1", "mod.2", "mod.3", "mod.4", "mod.5", "mod.6", "mod.7", "mod.8", 
                "mod.9", "mod.10", "mod.11", "mod.12", "mod.13", "mod.14", "mod.15"))

```

Based on these results we can see that model 15 is the superior model (lowest AICc value).


## Model 16

Due to the fact that __Brillouin.Index2__ was deemed unnecessary in the Attendance Model and has proven unnecessary for the In Situ portion of this model, we choose to remove this variable entirely once again. The model summary, fit indices and modification indices were all generated for the model.


```{r 16th In Situ SEM Abund}
# In Situ SEM (Abundance)

# Model 16
# Removal of Brillouin.Index2

mod.IS16A <- 'Attendance2 ~ Sp.Richness2 + Total.Animals2
+ Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2

insitu2 ~ Attendance2 + Zoo.Area.ha2
+ Prop.Threat.Abund2'

# Fit model and generate model summary
mod.IS16A.fit <- sem(mod.IS16A , data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS16A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS16A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS16A <- modindices(mod.IS16A.fit)
print(miIS16A[miIS16A$mi > 3.0,])

```


## Model Comparisons

Once again we compare the models generated using AICc values in order to ensure the removal of the __Brillouin.Index2__ was statistically justified. Overall model selection from the pool of competing models is achieved using AICc values, with a threshold of more than 2 AICc units lower than nearest competing model being considered sufficient for model selection. 

```{r 2nd, AICc In Situ SEM Abund}
# Model Comparisons using AICc

# Comparing models with and without adjustment for nested nature of data
# library(AICcmodavg) 
# source("lavaan.modavg.R")

aictab.lavaan(list(mod.IS1A.fit, mod.IS2A.fit, mod.IS3A.fit, mod.IS4A.fit, mod.IS5A.fit, 
                   mod.IS6A.fit, mod.IS7A.fit, mod.IS8A.fit, mod.IS9A.fit, mod.IS10A.fit,
                   mod.IS11A.fit, mod.IS12A.fit, mod.IS13A.fit, mod.IS14A.fit, mod.IS15A.fit, mod.IS16A.fit), 
              c("mod.1", "mod.2", "mod.3", "mod.4", "mod.5", "mod.6", "mod.7", "mod.8", 
                "mod.9", "mod.10", "mod.11", "mod.12", "mod.13", "mod.14", "mod.15", "mod.16"))

```

Based on these results we can see that model 16 is the superior model (lowest AICc value) and that __Brillouin.Index2__ was not supported.


## Model 17

Based on the results generated from the sixteenth model, the highest p-value relationship to be considered for removal is __Attendance2 ~ Sp.Richness2__ with a p-value of __0.505__. Therefore we decide to remove this pathway. The model summary, fit indices and modification indices were all generated for the model.


```{r 17th In Situ SEM Abund}
# In Situ SEM (Abundance)

# Model 17
# Removal of Attendance2 ~ Sp.Richness2, p = 0.505

mod.IS17A <- 'Attendance2 ~ Total.Animals2
+ Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2

insitu2 ~ Attendance2 + Zoo.Area.ha2
+ Prop.Threat.Abund2'

# Fit model and generate model summary
mod.IS17A.fit <- sem(mod.IS17A , data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.IS17A.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.IS17A.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miIS17A <- modindices(mod.IS17A.fit)
print(miIS17A[miIS17A$mi > 3.0,])

```


# Final In Situ Model (Species Abundance)

Based on the results, we believe model 17 is an accurate representation of the system. No further addition seems conceptually appealling or statistically justified. In addition all pathways appear significant. Therefore we present model 17 as our final In Situ Model based on species abundance data. 

```{r Final In Situ SEM Abund}
# Chosen In Situ SEM (Abundance)
# Model 17

mod.ISAFinal <- 'Attendance2 ~ Total.Animals2
+ Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2

insitu2 ~ Attendance2 + Zoo.Area.ha2
+ Prop.Threat.Abund2'

# Fit model and generate model summary
mod.ISAFinal.fit <- sem(mod.ISAFinal, data = sem_in_situ_data, fixed.x=FALSE)
summary(mod.ISAFinal.fit, rsq = TRUE)

# Generate fit indices
fitMeasures(mod.ISAFinal.fit, c("agfi", "rmr", "srmr", "rmsea", "cfi", "nnfi", "tli"))

# Generate modification indices
miISAFinal <- modindices(mod.ISAFinal.fit)
print(miISAFinal[miISAFinal$mi > 3.0,])

```


## Tests of Mediation 


It is clear from Model 17 that several pathways are mediated in the system. It is necessary to evaluate whether this mediation is appropriate by comparing models with complete, partial and no mediation. Here we show tests of mediation for three of these relationships. 

### insitu2 ~ Mean.Sp.BodyMassXAbund2

__insitu2 ~ Mean.Sp.BodyMassXAbund2__ is completely mediated by __Attendance2 ~ Mean.Sp.BodyMass2__. Below we compare models with complete (full, i.e. Model 17) mediation, partial mediation and no mediation. Results from this output suggest that complete mediation (model 17) is the superior model.

```{r Mediation1 In Situ SEM Abund}

# Complete Mediation Model (Model 17)

FULL1A.MOD17 <- 'Attendance2 ~ Total.Animals2
+ Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2

insitu2 ~ Attendance2 + Zoo.Area.ha2
+ Prop.Threat.Abund2'

FULL1A.MOD17.fit <- sem(FULL1A.MOD17, data = sem_in_situ_data, fixed.x=FALSE)

# Partial Mediation Model

PARTIAL1A <- 'Attendance2 ~ Total.Animals2
+ Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2

insitu2 ~ Attendance2 + Zoo.Area.ha2
+ Prop.Threat.Abund2 + Mean.Sp.BodyMassXAbund2'

PARTIAL1A.fit <- sem(PARTIAL1A, data = sem_in_situ_data, fixed.x=FALSE)

# No Mediation Model

NONE1A <- 'Attendance2 ~ Total.Animals2
+ Mean.Raup.Crick2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2

insitu2 ~ Attendance2 + Zoo.Area.ha2
+ Prop.Threat.Abund2 + Mean.Sp.BodyMassXAbund2'

NONE1A.fit <- sem(NONE1A, data = sem_in_situ_data, fixed.x=FALSE)

aictab.lavaan(list(FULL1A.MOD17.fit, PARTIAL1A.fit, NONE1A.fit), 
              c("full mediation", "partial mediation", "no mediation"))

```


### insitu2 ~ Prop.Threat.Abund2

__insitu2 ~ Prop.Threat.Abund2__ is not mediated. Therefore we want to test if partial mediation is appropriate by including by __Attendance2 ~ Prop.Threat.Abund2__. Below we compare models with complete (full) mediation, partial mediation and no mediation (Model 17). Results from this output suggest that no mediation (model 17) is the superior model.

```{r Mediation2 In Situ SEM Abund}

# Complete Mediation Model

FULL2A <- 'Attendance2 ~ Total.Animals2
+ Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2 + X10km_Pop2 + Prop.Threat.Abund2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2

insitu2 ~ Attendance2 + Zoo.Area.ha2'

FULL2A.fit <- sem(FULL2A, data = sem_in_situ_data, fixed.x=FALSE)

# Partial Mediation Model

PARTIAL2A <- 'Attendance2 ~ Total.Animals2
+ Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2 + X10km_Pop2 + Prop.Threat.Abund2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2

insitu2 ~ Attendance2 + Zoo.Area.ha2
+ Prop.Threat.Abund2'

PARTIAL2A.fit <- sem(PARTIAL2A, data = sem_in_situ_data, fixed.x=FALSE)

# No Mediation Model (Model 17)

NONE2A.MOD17 <- 'Attendance2 ~ Total.Animals2
+ Mean.Sp.BodyMassXAbund2 + Mean.Raup.Crick2 + X10km_Pop2

Total.Animals2 ~ Zoo.Area.ha2 + Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Sp.Richness2 ~ Mam.Sp.Richness2 + Mean.Sp.BodyMassXAbund2
Mean.Raup.Crick2 ~ Mean.Sp.BodyMassXAbund2 + Zoo.Area.ha2

insitu2 ~ Attendance2 + Zoo.Area.ha2
+ Prop.Threat.Abund2'

NONE2A.MOD17.fit <- sem(NONE2A.MOD17, data = sem_in_situ_data, fixed.x=FALSE)

aictab.lavaan(list(FULL2A.fit, PARTIAL2A.fit, NONE2A.MOD17.fit), 
              c("full mediation", "partial mediation", "no mediation"))

```

## Calculating Total Effects

Total effects of insitutional variables and socio-economic factors on visitor Attendance and In situ contributions is calculated using the direct and indirect effects from the final model. An example for the Attendance and In Situ models for the abundance adjusted models (Table 2) is given below.


```{r total effects calculation}
## Total effects
## Yvonne Buckley
## 03/10/19

## Attendance model
att_totanimal <- coef(mod.20A.final.fit)[labels(coef(mod.20A.final.fit)) == "Attendance2~Total.Animals2"]
att_10k <- coef(mod.20A.final.fit)[labels(coef(mod.20A.final.fit)) == "Attendance2~X10km_Pop2"]
att_body <- coef(mod.20A.final.fit)[labels(coef(mod.20A.final.fit)) == "Attendance2~Mean.Sp.BodyMassXAbund2"]
att_GDP <- coef(mod.20A.final.fit)[labels(coef(mod.20A.final.fit)) == "Attendance2~GDP.Millions2"]
att_diss <- coef(mod.20A.final.fit)[labels(coef(mod.20A.final.fit)) == "Attendance2~Mean.Raup.Crick2"]
att_mamm <- coef(mod.20A.final.fit)[labels(coef(mod.20A.final.fit)) == "Attendance2~Mam.Sp.Richness2"]
att_spr <- coef(mod.20A.final.fit)[labels(coef(mod.20A.final.fit)) == "Attendance2~Sp.Richness2"]

totan_spr <- coef(mod.20A.final.fit)[labels(coef(mod.20A.final.fit)) == "Total.Animals2~Sp.Richness2"]
totan_area <- coef(mod.20A.final.fit)[labels(coef(mod.20A.final.fit)) == "Total.Animals2~Zoo.Area.ha2"]
totan_GDP <- coef(mod.20A.final.fit)[labels(coef(mod.20A.final.fit)) == "Total.Animals2~GDP.Millions2"]
totan_body <- coef(mod.20A.final.fit)[labels(coef(mod.20A.final.fit)) == "Total.Animals2~Mean.Sp.BodyMassXAbund2"]

spr_mamm <- coef(mod.20A.final.fit)[labels(coef(mod.20A.final.fit)) == "Sp.Richness2~Mam.Sp.Richness2"]
spr_area <- coef(mod.20A.final.fit)[labels(coef(mod.20A.final.fit)) == "Sp.Richness2~Zoo.Area.ha2"]
spr_body <- coef(mod.20A.final.fit)[labels(coef(mod.20A.final.fit)) == "Sp.Richness2~Mean.Sp.BodyMassXAbund2"]

diss_area <- coef(mod.20A.final.fit)[labels(coef(mod.20A.final.fit)) == "Mean.Raup.Crick2~Zoo.Area.ha2"]
diss_body <- coef(mod.20A.final.fit)[labels(coef(mod.20A.final.fit)) == "Mean.Raup.Crick2~Mean.Sp.BodyMassXAbund2"]

##In situ model
is_att <- coef(mod.ISAFinal.fit)[labels(coef(mod.ISAFinal.fit)) == "insitu2~Attendance2"]
is_tsp <- coef(mod.ISAFinal.fit)[labels(coef(mod.ISAFinal.fit)) == "insitu2~Prop.Threat.Abund2"]
is_area <- coef(mod.ISAFinal.fit)[labels(coef(mod.ISAFinal.fit)) == "insitu2~Zoo.Area.ha2"]

## ATTENDANCE Total Effects
##Total Animals
TEatt_totanimal <- att_totanimal
print(paste("Attendance ~ Total Animals", TEatt_totanimal, sep = "  "))

## 10km population density
TEatt_10k <- att_10k
print(paste("Attendance ~ 10km Population", TEatt_10k, sep = "  "))

## Body Mass
TEatt_body <- att_body + diss_body * att_diss + spr_body * att_spr + spr_body * totan_spr *att_totanimal + 
  totan_body * att_totanimal
print(paste("Attendance ~ Body Mass", TEatt_body, sep = "  "))

## GDP
TEatt_GDP <- att_GDP + totan_GDP * att_totanimal
print(paste("Attendance ~ GDP", TEatt_GDP, sep = "  "))

## Dissimilarity
TEatt_diss <- att_diss
print(paste("Attendance ~ Dissimilarity", TEatt_diss, sep = "  "))

## Mammal Species Richness
TEatt_mamm <- att_mamm +spr_mamm * totan_spr * att_totanimal + spr_mamm * att_spr
print(paste("Attendance ~ Mammal Species Richness", TEatt_mamm, sep = "  "))

## Species Richness
TEatt_spr <- att_spr + totan_spr * att_totanimal
print(paste("Attendance ~ Species Richness", TEatt_spr, sep = "  "))

## TOTAL ANIMALS Total Effects
## Species richness
TEta_spr <- totan_spr
print(paste("Total Animals ~ Species Richness", TEta_spr, sep = "  "))

## Institution Area
TEta_area <- totan_area + spr_area * totan_spr
print(paste("Total Animals ~ Area", TEta_area, sep = "  "))

## GDP
TEta_GDP <- totan_GDP
print(paste("Total Animals ~ GDP", TEta_GDP, sep = "  "))

## Body Mass
TEta_body <- totan_body + spr_body *totan_spr
print(paste("Total Animals ~ Body Mass", TEta_body, sep = "  "))

## SPECIES RICHNESS Total Effects
## Mammal Species Richness
TEsr_mamm <- spr_mamm
print(paste("Species Richness ~ Mammal Species Richness", TEsr_mamm, sep = "  "))

## Institution Area
TEsr_area <- spr_area
print(paste("Species Richness ~ Area", TEsr_area, sep = "  "))


## Body Mass
TEsr_body <- spr_body 
print(paste("Species Richness ~ Body Mass", TEsr_body, sep = "  "))


## DISSIMILARITY Total Effects
##Institution Area
TEds_area <- diss_area
print(paste("Dissimilarity ~ Area", TEds_area, sep = "  "))

## Body Mass
TEds_body <- diss_body
print(paste("Dissimilarity ~ Body Mass", TEds_body, sep = "  "))

## IN SITU Total Effects
## Attendance
TEis_att <- is_att
print(paste("In Situ ~ Attendance", TEis_att, sep = "  "))

## Proportion Threatened Species
TEis_ts <- is_tsp
print(paste("In Situ ~ Threatened Species Proportion", TEis_ts, sep = "  "))

## Institution Area
TEis_area <- is_area + diss_area * att_diss * is_att + spr_area * totan_spr * att_totanimal * is_att +
  totan_area * att_totanimal * is_att
print(paste("In Situ ~ Area", TEis_area, sep = "  "))


```


## References:

Burnham, K. P., Anderson, D. R. & Burnham, K. P. Model selection and multimodel inference: a practical information-theoretic approach. (Springer, 2002).

Fan, Y. et al. Applications of structural equation modeling (SEM) in ecological studies: an updated review. Ecol. Process. 5, 19 (2016).

Grace, J. B., Scheiner, S. M. & Schoolmaster, D. R. J. Structural equation modeling: building and evaluating causal models. in Ecological Statistics: Contemporary theory and application (eds. Fox, G. A., Negrete-Yankelevich, S. & Sosa, V. J.) 168-199 (Oxford University Press, 2015).

Grace, J. B. et al. Integrative modelling reveals mechanisms linking productivity and plant species richness. Nature 529, 390-393 (2016).

Hu, L. & Bentler, P. M. Cutoff criteria for fit indexes in covariance structure analysis: Conventional criteria versus new alternatives. Struct. Equ. Model. A Multidiscip. J. 6, 1-55 (1999).

Martin et al., 2014: Mammal and bird species held in zoos are less endemic and less threatened than their close relatives not held in zoos
Frynta et al., 2013: Mammalian Collection on Noah's Ark: The Effects of Beauty, Brain and Body Size


